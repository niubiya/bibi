<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<title>
  
    bibi
  
</title>

<meta name="description" content="Testing website">
<meta property="og:type" content="website">
<meta property="og:title" content="bibi">
<meta property="og:url" content="http://yxbibi.com/page/3/index.html">
<meta property="og:site_name" content="bibi">
<meta property="og:description" content="Testing website">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="bibi">
<meta name="twitter:description" content="Testing website">


  <link rel="alternative" href="/atom.xml" title="bibi" type="application/atom+xml">



  <link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="/perfect-scrollbar/css/perfect-scrollbar.min.css">
<link rel="stylesheet" href="/styles/main.css">






</head>
<body class="monochrome">
  <div class="mobile-header">
  <button class="sidebar-toggle" type="button">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <a class="title" href="/">bibi</a>
</div>

  <div class="main-container">
    <div class="sidebar">
  <div class="header">
    <h1 class="title"><a href="/">bibi</a></h1>
    
    <div class="info">
      <div class="content">
        
          <div class="description">Testing website</div>
        
        
          <div class="author">Mode</div>
        
      </div>
      
        <div class="avatar">
          
            <a href="/about"><img src="https://cn.gravatar.com/avatar/35fef74d731255cd569c2c2b0b9e87e4?s=200"></a>
          
        </div>
      
    </div>
  </div>
  <div class="body">
    
      
        <ul class="nav">
          
            
              <li class="category-list-container">
                <a href="javascript:;">Category</a>
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Openresty/">Openresty</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Zabbix/">Zabbix</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/centos/">centos</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/centos7/">centos7</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/rsync/">rsync</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/text/">text</a><span class="category-list-count">1</span></li></ul>
              </li>
            
          
            
              <li class="tag-list-container">
                <a href="javascript:;">Tag</a>
                <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/DNS服务器搭建/">DNS服务器搭建</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ELK/">ELK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EMQ/">EMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Filebeat/">Filebeat</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JumpServer/">JumpServer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KONG/">KONG</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LVM/">LVM</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Memcached/">Memcached</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openresty/">Openresty</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/">PHP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PXE-Kickstart-Cobbler/">PXE+Kickstart+Cobbler</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis3/">Redis3</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rsync-inotify/">Rsync+inotify</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat/">Tomcat</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zabbix/">Zabbix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/app-install/">app install</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bibi/">bibi</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos7/">centos7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ftp虚拟用户创建过程/">ftp虚拟用户创建过程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hello/">hello</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lvm/">lvm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openssl/">openssl</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsync/">rsync</a><span class="tag-list-count">1</span></li></ul>
              </li>
            
          
            
              <li class="archive-list-container">
                <a href="javascript:;">Archive</a>
                <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">30</span></li></ul>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="/" title="Homepage">Homepage</a>
              </li>
            
          
            
              <li>
                <a href="/archives" title="By Year">By Year</a>
              </li>
            
          
        </ul>
      
        <ul class="nav">
          
            
              <li>
                <a href="https://github.com/denjones/hexo-theme-chan" title="Chan" target="_blank" rel="noopener">Chan</a>
              </li>
            
          
            
              <li>
                <a href="https://github.com/denjones" title="Github" target="_blank" rel="noopener">Github</a>
              </li>
            
          
            
              <li>
                <a href="/atom.xml" title="RSS">RSS</a>
              </li>
            
          
        </ul>
      
    
  </div>
</div>

    <div class="main-content">
      
        <div style="max-width: 1000px">
      
          

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2019/08/08/Redis/">
  Redis
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2019/08/08/Redis/"><span class="article-date">
  2019-08-08
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/centos/">centos</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/centos/Redis/">Redis</a></li></ul></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redis/">Redis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p> [隐藏] </p>
<ul>
<li>[1安装依赖]</li>
<li>[2编译安装]</li>
<li>[3redis配置文件]</li>
<li>[4systemd启动脚本]</li>
<li>[5redis 5 yum安装]</li>
</ul>
<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc</span><br></pre></td></tr></table></figure>

<h2 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-4.0.11.tar.gz</span><br><span class="line">tar -xzf redis-4.0.11.tar.gz</span><br><span class="line">cd redis-4.0.11</span><br><span class="line">make MALLOC=libc</span><br><span class="line">cd src &amp;&amp; make</span><br><span class="line">make PREFIX=/data/soft/redis install</span><br></pre></td></tr></table></figure>

<h2 id="redis配置文件"><a href="#redis配置文件" class="headerlink" title="redis配置文件"></a>redis配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/soft/redis/etc/</span><br><span class="line">cat &gt; /data/soft/redis/etc/redis.conf &lt;&lt;EOF</span><br><span class="line">daemonize no</span><br><span class="line">port 6379</span><br><span class="line">logfile &quot;/data/logs/redis.log&quot;</span><br><span class="line">protected-mode no</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="systemd启动脚本"><a href="#systemd启动脚本" class="headerlink" title="systemd启动脚本"></a>systemd启动脚本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /lib/systemd/system/redis.service &lt;&lt;EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description=Redis</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">PIDFile=/data/run/redis.pid</span><br><span class="line">ExecStart=/data/soft/redis/bin/redis-server /data/soft/redis/etc/redis.conf</span><br><span class="line">User=root</span><br><span class="line">Group=root</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">chmod u+x /lib/systemd/system/redis.service</span><br><span class="line"></span><br><span class="line">systemctl enable redis.service</span><br><span class="line">systemctl start redis.service</span><br></pre></td></tr></table></figure>

<h2 id="redis-5-yum安装"><a href="#redis-5-yum安装" class="headerlink" title="redis 5 yum安装"></a>redis 5 yum安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br><span class="line">rpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-7.rpm    (centos7)</span><br><span class="line">rpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm    (centos6)</span><br><span class="line"></span><br><span class="line">yum --enablerepo=remi install redis</span><br><span class="line"></span><br><span class="line">安装完成之后，配置文件在/etc/redis.conf</span><br><span class="line">置为系统服务，启动用户为redis</span><br></pre></td></tr></table></figure>


        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2019/08/08/Redis3_cluster/">
  Redis3 Cluster
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2019/08/08/Redis3_cluster/"><span class="article-date">
  2019-08-08
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/centos/">centos</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/centos/Redis3/">Redis3</a></li></ul></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redis3/">Redis3</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <h1 id="Redis3-cluster"><a href="#Redis3-cluster" class="headerlink" title="Redis3 cluster"></a>Redis3 cluster</h1><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p> [隐藏] </p>
<ul>
<li>[1安装依赖包]</li>
<li>[2创建用户]</li>
<li>[3开始安装redis]</li>
<li>[4配置为系统服务]</li>
<li>[5添加为系统服务]</li>
<li>[6添加配置文件]</li>
<li>[7建立目录]</li>
<li>[8修改系统配置]</li>
<li>[9启动redis]</li>
<li>10部署集群<ul>
<li>[10.1准备工作]</li>
<li>[10.2安装ruby、redis插件]</li>
<li>[10.3拷贝redis-trib.rb]</li>
<li>[10.4打开防火墙端口]</li>
<li>[10.5创建集群]</li>
<li>[10.6确认集群创建成功]</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install wget vim openssl openssl-devel zlib zlib-devel gcc gcc-c++ epel-release jemalloc jemalloc-devel</span><br></pre></td></tr></table></figure>

<h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd redis</span><br><span class="line">useradd -gredis -s /sbin/nologin -M redis</span><br></pre></td></tr></table></figure>

<h3 id="开始安装redis"><a href="#开始安装redis" class="headerlink" title="开始安装redis"></a>开始安装redis</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/releases/redis-3.2.10.tar.gz</span><br><span class="line">tar xzf redis-3.2.10.tar.gz</span><br><span class="line">cd redis-3.2.10</span><br><span class="line">make MALLOC=jemalloc</span><br><span class="line">make PREFIX=/data/soft/redisc install</span><br></pre></td></tr></table></figure>

<h3 id="配置为系统服务"><a href="#配置为系统服务" class="headerlink" title="配置为系统服务"></a>配置为系统服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/init.d/redis_6380</span><br></pre></td></tr></table></figure>

<p>加入以下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">#</span><br><span class="line"># redis        init file for starting up the redis daemon</span><br><span class="line">#</span><br><span class="line"># chkconfig:   - 20 80</span><br><span class="line"># description: Starts and stops the redis daemon.</span><br><span class="line"></span><br><span class="line"># Source function library.</span><br><span class="line">. /etc/rc.d/init.d/functions</span><br><span class="line"></span><br><span class="line">name=&quot;redis-server&quot;</span><br><span class="line">exec=&quot;/data/soft/redisc/bin/$name&quot;</span><br><span class="line">pidfile=&quot;/var/run/redis/redis_6380.pid&quot;</span><br><span class="line">REDIS_CONFIG=&quot;/data/soft/redisc/6380.conf&quot;</span><br><span class="line"></span><br><span class="line">[ -e /etc/sysconfig/redis ] &amp;&amp; . /etc/sysconfig/redis</span><br><span class="line"></span><br><span class="line">lockfile=/var/lock/subsys/redis_6380</span><br><span class="line"></span><br><span class="line">start() &#123;</span><br><span class="line">    [ -f $REDIS_CONFIG ] || exit 6</span><br><span class="line">    [ -x $exec ] || exit 5</span><br><span class="line">    echo -n $&quot;Starting $name: &quot;</span><br><span class="line">    daemon --user $&#123;REDIS_USER-redis&#125; &quot;$exec $REDIS_CONFIG&quot;</span><br><span class="line">    retval=$?</span><br><span class="line">    echo</span><br><span class="line">    [ $retval -eq 0 ] &amp;&amp; touch $lockfile</span><br><span class="line">    return $retval</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stop() &#123;</span><br><span class="line">    echo -n $&quot;Stopping $name: &quot;</span><br><span class="line">    killproc -p $pidfile $name</span><br><span class="line">    retval=$?</span><br><span class="line">    echo</span><br><span class="line">    [ $retval -eq 0 ] &amp;&amp; unlink $lockfile</span><br><span class="line">    return $retval</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">restart() &#123;</span><br><span class="line">    stop</span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reload() &#123;</span><br><span class="line">    false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rh_status() &#123;</span><br><span class="line">    status -p $pidfile $name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rh_status_q() &#123;</span><br><span class="line">    rh_status &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    start)</span><br><span class="line">        rh_status_q &amp;&amp; exit 0</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        rh_status_q || exit 0</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    restart)</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    reload)</span><br><span class="line">        rh_status_q || exit 7</span><br><span class="line">        $1</span><br><span class="line">        ;;</span><br><span class="line">    force-reload)</span><br><span class="line">        force_reload</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        rh_status</span><br><span class="line">        ;;</span><br><span class="line">    condrestart|try-restart)</span><br><span class="line">        rh_status_q || exit 0</span><br><span class="line">        restart</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        echo $&quot;Usage: $0 &#123;start|stop|status|restart|condrestart|try-restart&#125;&quot;</span><br><span class="line">        exit 2</span><br><span class="line">esac</span><br><span class="line">exit $?</span><br></pre></td></tr></table></figure>

<h3 id="添加为系统服务"><a href="#添加为系统服务" class="headerlink" title="添加为系统服务"></a>添加为系统服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod u+x /etc/init.d/redis_6380</span><br><span class="line">chkconfig --add redis_6380</span><br><span class="line">chkconfig redis_6380 on</span><br></pre></td></tr></table></figure>

<h3 id="添加配置文件"><a href="#添加配置文件" class="headerlink" title="添加配置文件"></a>添加配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /data/soft/redisc/6380.conf &lt;&lt; EOF</span><br><span class="line">protected-mode no</span><br><span class="line">port 6380</span><br><span class="line">tcp-backlog 511</span><br><span class="line">timeout 0</span><br><span class="line">tcp-keepalive 300</span><br><span class="line">daemonize yes</span><br><span class="line">supervised no</span><br><span class="line">pidfile /var/run/redis/redis_6380.pid</span><br><span class="line">loglevel notice</span><br><span class="line">logfile /data/logs/redis/redis_6380.log</span><br><span class="line">databases 16</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line">rdbcompression yes</span><br><span class="line">rdbchecksum yes</span><br><span class="line">dbfilename cluster.rdb</span><br><span class="line">dir /data/soft/redisc/data/6380</span><br><span class="line">slave-serve-stale-data yes</span><br><span class="line">slave-read-only yes</span><br><span class="line">repl-diskless-sync no</span><br><span class="line">repl-diskless-sync-delay 5</span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line">slave-priority 100</span><br><span class="line">appendonly yes</span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line">appendfsync everysec</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line">aof-load-truncated yes</span><br><span class="line">lua-time-limit 5000</span><br><span class="line">slowlog-log-slower-than 10000</span><br><span class="line">slowlog-max-len 128</span><br><span class="line">latency-monitor-threshold 0</span><br><span class="line">notify-keyspace-events &quot;&quot;</span><br><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br><span class="line">list-max-ziplist-size -2</span><br><span class="line">list-compress-depth 0</span><br><span class="line">set-max-intset-entries 512</span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line">hll-sparse-max-bytes 3000</span><br><span class="line">activerehashing yes</span><br><span class="line">client-output-buffer-limit normal 0 0 0</span><br><span class="line">client-output-buffer-limit slave 256mb 64mb 60</span><br><span class="line">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line">hz 10</span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="建立目录"><a href="#建立目录" class="headerlink" title="建立目录"></a>建立目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/logs/redis</span><br><span class="line">mkdir -p /data/soft/redisc/data/6380</span><br><span class="line">mkdir -p /var/run/redis</span><br><span class="line"></span><br><span class="line">chown -R redis.redis /data/logs/redis</span><br><span class="line">chown -R redis.redis /data/soft/redisc</span><br><span class="line">chown -R redis.redis /var/run/redis</span><br></pre></td></tr></table></figure>

<h3 id="修改系统配置"><a href="#修改系统配置" class="headerlink" title="修改系统配置"></a>修改系统配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line">echo &quot;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&quot; &gt;&gt;/etc/rc.local</span><br><span class="line"></span><br><span class="line">chmod u+x /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure>

<h3 id="启动redis"><a href="#启动redis" class="headerlink" title="启动redis"></a>启动redis</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service redis_6380 start</span><br></pre></td></tr></table></figure>

<h3 id="部署集群"><a href="#部署集群" class="headerlink" title="部署集群"></a>部署集群</h3><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><p>重置上边的步骤</p>
<p>修改配置（6380改为6381等）</p>
<p>建立一共6个redis（同一机器需要不同端口 不同机器可同一端口）</p>
<p>组成三主三从的高可用redis集群</p>
<h4 id="安装ruby、redis插件"><a href="#安装ruby、redis插件" class="headerlink" title="安装ruby、redis插件"></a>安装ruby、redis插件</h4><p>安装集群，在其中一台机器上执行即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install centos-release-scl-rh</span><br><span class="line">yum install rh-ruby23 rubygems -y</span><br><span class="line">scl  enable  rh-ruby23 bash</span><br><span class="line">ruby -v</span><br><span class="line">gem install redis -v 3.3.3</span><br></pre></td></tr></table></figure>

<h4 id="拷贝redis-trib-rb"><a href="#拷贝redis-trib-rb" class="headerlink" title="拷贝redis-trib.rb"></a>拷贝redis-trib.rb</h4><p>在编译目录下复制创建集群命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp redis-3.2.10/src/redis-trib.rb  /data/soft/redisc/bin</span><br></pre></td></tr></table></figure>

<h4 id="打开防火墙端口"><a href="#打开防火墙端口" class="headerlink" title="打开防火墙端口"></a>打开防火墙端口</h4><p>防火墙打开相应的端口，如：6380和 16380（集群通讯用）</p>
<h4 id="创建集群"><a href="#创建集群" class="headerlink" title="创建集群"></a>创建集群</h4><p>开始创建集群，根据服务器IP和端口添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-trib.rb create --replicas 1 0.0.0.0:6380 1.1.1.1:6381 2.2.2.2:6380 3.3.3.3:6381 4.4.4.4:6380 5.5.5.5:6381</span><br></pre></td></tr></table></figure>

<h4 id="确认集群创建成功"><a href="#确认集群创建成功" class="headerlink" title="确认集群创建成功"></a>确认集群创建成功</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c -p 6380</span><br><span class="line">CLUSTER NODES</span><br><span class="line">127.0.0.1:6380&gt; CLUSTER NODES</span><br><span class="line">e0899e108ad4bdda1ff4e73cc4170c632779ce02 0.0.0.0:6381 slave 727ea1c3d22e39d72ab9a3b26c73311666f61a61 0 1548123431966 3 connected</span><br><span class="line">2d3f764f4aac76b9ecc2ec1c9fcdd97e214f9cba 1.1.1.1:6381 slave c054f91fe9ac917982959d27d689dfee7ed8b941 0 1548123432968 4 connected</span><br><span class="line">727ea1c3d22e39d72ab9a3b26c73311666f61a61 2.2.2.2:6380 master - 0 1548123429963 3 connected 5461-10922</span><br><span class="line">57e28960f806c9a586bab351265631ad750283cb 3.3.3.3:6380 master - 0 1548123426959 5 connected 10923-16383</span><br><span class="line">751d444e0c4a9b354b50ea5d070e5d59383af201 4.4.4.4:6381 slave 57e28960f806c9a586bab351265631ad750283cb 0 1548123430963 6 connected</span><br><span class="line">c054f91fe9ac917982959d27d689dfee7ed8b941 5.5.5.5:6380 myself,master - 0 0 1 connected 0-5460</span><br></pre></td></tr></table></figure>


        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2019/08/08/Rsync+inotify/">
  Rsync+inotify
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2019/08/08/Rsync+inotify/"><span class="article-date">
  2019-08-08
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/centos/">centos</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/centos/Rsync-inotify/">Rsync+inotify</a></li></ul></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rsync-inotify/">Rsync+inotify</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <h1 id="Rsync-inotify"><a href="#Rsync-inotify" class="headerlink" title="Rsync+inotify"></a>Rsync+inotify</h1><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p> [隐藏] </p>
<ul>
<li>1服务端<ul>
<li>[1.1安装依赖]</li>
<li>[1.2服务端配置]</li>
</ul>
</li>
<li>2推送端<ul>
<li>[2.1密码配置]</li>
<li>[2.2测试]</li>
<li>[2.3inotify]</li>
<li>[2.4inotify脚本]</li>
<li>[2.5inotify启动配置]</li>
</ul>
</li>
</ul>
<h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y rsync</span><br></pre></td></tr></table></figure>

<h4 id="服务端配置"><a href="#服务端配置" class="headerlink" title="服务端配置"></a>服务端配置</h4><p>配置 /etc/rsyncd.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[test]</span><br><span class="line">uid = www</span><br><span class="line">gid = www</span><br><span class="line">path = /data/www/rsynctest/</span><br><span class="line">hosts allow = 1.1.1.1</span><br><span class="line">use chroot = no</span><br><span class="line">read only = no</span><br><span class="line">list = no</span><br><span class="line">auth users = test</span><br><span class="line">secrets file = /data/etc/rsync.secrets</span><br></pre></td></tr></table></figure>

<p>生成密码文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;test:test&quot; &gt; /data/etc/rsync.secrets</span><br></pre></td></tr></table></figure>

<h2 id="推送端"><a href="#推送端" class="headerlink" title="推送端"></a>推送端</h2><h4 id="密码配置"><a href="#密码配置" class="headerlink" title="密码配置"></a>密码配置</h4><p>echo “data:data” &gt; /data/etc/rsync.secret</p>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir test</span><br><span class="line">touch test/1</span><br><span class="line">touch test/2</span><br><span class="line">touch test/3</span><br><span class="line"></span><br><span class="line">rsync -az --no-o --no-g test test@103.243.93.10::test/ --password-file=/data/etc/rsync.secret</span><br></pre></td></tr></table></figure>

<h4 id="inotify"><a href="#inotify" class="headerlink" title="inotify"></a>inotify</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://github.com/downloads/rvoicilas/inotify-tools/inotify-tools-3.14.tar.gz</span><br><span class="line">tar -xzf inotify-tools-3.14.tar.gz </span><br><span class="line">cd inotify-tools-3.14</span><br><span class="line">./configure --prefix=/data/soft/inotify-tools</span><br><span class="line">make -j4</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h4 id="inotify脚本"><a href="#inotify脚本" class="headerlink" title="inotify脚本"></a>inotify脚本</h4><p>/data/scripts/sync.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">inotify=/data/soft/inotify-tools/bin/inotifywait</span><br><span class="line">$inotify -mrq --timefmt &apos;%d/%m/%y %H:%M&apos; --format &apos;%T %w%f&apos; -e delete,close_write,moved_to,moved_from,isdir /root/123  \</span><br><span class="line">|while read file</span><br><span class="line">do</span><br><span class="line">    cd / &amp;&amp;</span><br><span class="line">    rsync -az --no-o --no-g /root/123/* data@103.243.93.10::test/ --password-file=/data/etc/rsync.secret</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h4 id="inotify启动配置"><a href="#inotify启动配置" class="headerlink" title="inotify启动配置"></a>inotify启动配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib/systemd/system/inotify.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=&quot;rsync+inotify scripts&quot;</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Restart=always</span><br><span class="line">ExecStart=/bin/sh /data/scripts/sync.sh</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>


        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2019/08/08/Zabbix部署/">
  Zabbix部署
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2019/08/08/Zabbix部署/"><span class="article-date">
  2019-08-08
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Zabbix/">Zabbix</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Zabbix/centos/">centos</a></li></ul></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Zabbix/">Zabbix</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <h1 id="Zabbix部署"><a href="#Zabbix部署" class="headerlink" title="Zabbix部署"></a>Zabbix部署</h1><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p> [隐藏] </p>
<ul>
<li>[1安装yum源]</li>
<li>[2安装Zabbix 服务端、前端、代理进程]</li>
<li>[3解决图形乱码问题]</li>
<li>[5导入数据库]</li>
<li>[6Zabbix服务端数据库配置]</li>
<li>[7配置php时区]</li>
<li>[8启动服务]</li>
<li>[9登录Zabbix Web]</li>
</ul>
<h2 id="安装yum源"><a href="#安装yum源" class="headerlink" title="安装yum源"></a>安装yum源</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># rpm -i https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure>

<h2 id="安装Zabbix-服务端、前端、代理进程"><a href="#安装Zabbix-服务端、前端、代理进程" class="headerlink" title="安装Zabbix 服务端、前端、代理进程"></a>安装Zabbix 服务端、前端、代理进程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install zabbix-server-mysql zabbix-web-mysql zabbix-agent</span><br></pre></td></tr></table></figure>

<h2 id="解决图形乱码问题"><a href="#解决图形乱码问题" class="headerlink" title="解决图形乱码问题"></a>解决图形乱码问题</h2><p>把windows上的黑体字体 simhei.ttf拷贝到/usr/share/zabbix/fonts/目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/share/zabbix/include/defines.inc.php</span><br><span class="line">:%s /graphfont/simhei/g</span><br></pre></td></tr></table></figure>

<h2 id="创建初始数据库"><a href="#创建初始数据库" class="headerlink" title="创建初始数据库"></a>创建初始数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># mysql -uroot -p</span><br><span class="line">password</span><br><span class="line">mysql&gt; create database zabbix character set utf8 collate utf8_bin;</span><br><span class="line">mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by &apos;password&apos;;</span><br><span class="line">mysql&gt; quit;</span><br></pre></td></tr></table></figure>

<h2 id="导入数据库"><a href="#导入数据库" class="headerlink" title="导入数据库"></a>导入数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix</span><br></pre></td></tr></table></figure>

<h2 id="Zabbix服务端数据库配置"><a href="#Zabbix服务端数据库配置" class="headerlink" title="Zabbix服务端数据库配置"></a>Zabbix服务端数据库配置</h2><p>编辑 /etc/zabbix/zabbix_server.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">AlertScriptsPath=/usr/lib/zabbix/alertscripts</span><br><span class="line">DBHost=127.0.0.1</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=root</span><br><span class="line">ExternalScripts=/usr/lib/zabbix/externalscripts</span><br><span class="line">LogFileSize=0</span><br><span class="line">LogFile=/var/log/zabbix/zabbix_server.log</span><br><span class="line">LogSlowQueries=3000</span><br><span class="line">PidFile=/var/run/zabbix/zabbix_server.pid</span><br><span class="line">SNMPTrapperFile=/var/log/snmptrap/snmptrap.log</span><br><span class="line">SocketDir=/var/run/zabbix</span><br><span class="line">StartPingers=8</span><br><span class="line">Timeout=4</span><br></pre></td></tr></table></figure>

<h2 id="配置php时区"><a href="#配置php时区" class="headerlink" title="配置php时区"></a>配置php时区</h2><p>/etc/httpd/conf.d/zabbix.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php_value date.timezone &quot;Asia/Shanghai&quot;</span><br></pre></td></tr></table></figure>

<h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl restart zabbix-server zabbix-agent httpd</span><br><span class="line"># systemctl enable zabbix-server zabbix-agent httpd</span><br></pre></td></tr></table></figure>

<h2 id="登录Zabbix-Web"><a href="#登录Zabbix-Web" class="headerlink" title="登录Zabbix Web"></a>登录Zabbix Web</h2><p><a href="http://xxx.xxx.xxx.xxx/zabbix" target="_blank" rel="noopener">http://xxx.xxx.xxx.xxx/zabbix</a> 默认用户 Admin 默认密码 zabbix</p>

        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2019/08/08/hello/">
  Hello
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2019/08/08/hello/"><span class="article-date">
  2019-08-08
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/text/">text</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/text/test/">test</a></li></ul></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bibi/">bibi</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hello/">hello</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p><img src="/img/1-131123121938-50.jpg" alt="1-131123121938-50"></p>

        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2019/08/08/openssl/">
  Openssl解密
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2019/08/08/openssl/"><span class="article-date">
  2019-08-08
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/centos/">centos</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/centos/openssl/">openssl</a></li></ul></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bibi/">bibi</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openssl/">openssl</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p><img src="/img/1-131123121938-50.jpg" alt="1-131123121938-50"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">##所以命令都在Linux中执行##</span><br><span class="line">##查看是否安装了该工具,我的环境自带了,文章不做安装描述##</span><br><span class="line">openssl</span><br><span class="line">##加密(执行后获得加密码)##</span><br><span class="line">echo abc | openssl aes-128-cbc -k 123 -base64</span><br><span class="line">##解密(加密码太长,用*表示了)##</span><br><span class="line">echo ***** | openssl aes-128-cbc -d -k 123 -base64</span><br></pre></td></tr></table></figure>


        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2019/08/08/rsync服务CS架构/">
  Rsync
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2019/08/08/rsync服务CS架构/"><span class="article-date">
  2019-08-08
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/rsync/">rsync</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/rsync/centos/">centos</a></li></ul></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rsync/">rsync</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <h4 id="rsync服务C-S架构"><a href="#rsync服务C-S架构" class="headerlink" title="rsync服务C/S架构"></a>rsync服务C/S架构</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir /etc/rsyncd</span><br><span class="line"></span><br><span class="line">mkdir /data/backup</span><br><span class="line"></span><br><span class="line">mkdir /data/rsync</span><br></pre></td></tr></table></figure>

<h5 id="vim-rsyncd-conf"><a href="#vim-rsyncd-conf" class="headerlink" title="vim rsyncd.conf"></a>vim rsyncd.conf</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">port=9999</span><br><span class="line">log file=/var/log/rsync.log</span><br><span class="line">pid file=/var/run/rsyncd.pid</span><br><span class="line">log format=%t %a %m %f %b</span><br><span class="line"></span><br><span class="line">[sgamelog]</span><br><span class="line">path=/data/rsync/</span><br><span class="line">max connections=100</span><br><span class="line">ignore errors</span><br><span class="line">read only=no</span><br><span class="line">list=true</span><br><span class="line">uid=root</span><br><span class="line">gid=root</span><br><span class="line">auth users=sgame</span><br><span class="line">secrets file=/etc/rsyncd/rsyncd.passwd</span><br><span class="line">hosts allow=0.0.0.0</span><br><span class="line">comment = This is a sgamelog to sgame</span><br><span class="line"></span><br><span class="line">[backup]</span><br><span class="line">path=/data/backup/</span><br><span class="line">max connections=100</span><br><span class="line">ignore errors</span><br><span class="line">read only=no</span><br><span class="line">list=true</span><br><span class="line">uid=root</span><br><span class="line">gid=root</span><br><span class="line">auth users=sgame</span><br><span class="line">secrets file=/etc/rsyncd/rsyncd.passwd</span><br><span class="line">hosts allow= *</span><br><span class="line">comment = Backup directory</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim rsyncd.passwd</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sgame:sgamelog</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 rsyncd.passwd</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync --daemon --config=/etc/rsyncd/rsyncd.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rsyncd.passwd</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sgamelog</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -avP -q  /root/import_database.sh  --port 9999   sgame@0.0.0.0::backup  --password-file=/etc/rsyncd.passwd</span><br></pre></td></tr></table></figure>


        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2019/08/08/系统初始化/">
  系统初始化
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2019/08/08/系统初始化/"><span class="article-date">
  2019-08-08
</span>
</a>
        
	<span class="article-category tagcloud">
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/centos7/">centos7</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/centos7/linux/">linux</a></li></ul></li></ul>
	</span>


        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/centos7/">centos7</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <h1 id="系统初始化"><a href="#系统初始化" class="headerlink" title="系统初始化"></a>系统初始化</h1><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p> [隐藏] </p>
<ul>
<li>[1安装环境依赖]</li>
<li>[2初始化目录]</li>
<li>[3添加rootkey]</li>
<li>[4关闭selinux]</li>
<li>[5内核优化]</li>
<li>[6NTP设置]</li>
<li>[7Dnsmasq配置]</li>
<li>[8Zabbix配置]</li>
<li>[9修改语言]</li>
<li>[10修改时区]</li>
<li>[11优化服务]</li>
<li>[12系统优化]</li>
<li>[13SSH设置]</li>
<li>[14安全设置]</li>
</ul>
<h2 id="安装环境依赖"><a href="#安装环境依赖" class="headerlink" title="安装环境依赖"></a>安装环境依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rpm -i https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-agent-4.0.0-2.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">yum install -y wget psmisc sysstat bzip2 vim net-tools lrzsz ntp rsync dnsmasq mtr ftp</span><br><span class="line"></span><br><span class="line">yum install -y gcc gcc-c++ cmake libevent-devel pcre-devel zlib-devel gd-devel curl-devel libtool ncurses-devel libxml2-devel openssl-devel libicu-devel</span><br></pre></td></tr></table></figure>

<h2 id="初始化目录"><a href="#初始化目录" class="headerlink" title="初始化目录"></a>初始化目录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/etc</span><br><span class="line">mkdir -p /data/logs</span><br><span class="line">mkdir -p /data/soft</span><br><span class="line">mkdir -p /data/tmp</span><br><span class="line">mkdir -p /data/scripts</span><br><span class="line">chmod 1777 /data/tmp</span><br><span class="line">mkdir -p /data/backup</span><br><span class="line">chmod u+x /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure>

<h2 id="添加rootkey"><a href="#添加rootkey" class="headerlink" title="添加rootkey"></a>添加rootkey</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir /root/.ssh</span><br><span class="line">chmod 700 /root/.ssh</span><br><span class="line">cat &gt; /root/.ssh/authorized_keys  &lt;&lt; EOF</span><br><span class="line">ssh-rsa </span><br><span class="line">EOF</span><br><span class="line">chmod 600 /root/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<h2 id="关闭selinux"><a href="#关闭selinux" class="headerlink" title="关闭selinux"></a>关闭selinux</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br><span class="line">sed -i &apos;s/^SELINUX=enforcing/SELINUX=disabled/g&apos; /etc/selinux/config</span><br></pre></td></tr></table></figure>

<h2 id="内核优化"><a href="#内核优化" class="headerlink" title="内核优化"></a>内核优化</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/sysctl.conf &lt;&lt; EOF</span><br><span class="line">kernel.shmall = 4294967296</span><br><span class="line">net.ipv6.conf.all.disable_ipv6 = 1</span><br><span class="line">net.ipv6.conf.default.disable_ipv6 = 1</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 819200</span><br><span class="line">net.core.netdev_max_backlog = 32768</span><br><span class="line">net.core.somaxconn = 32768</span><br><span class="line">net.core.wmem_default = 8388608</span><br><span class="line">net.core.rmem_default = 8388608</span><br><span class="line">net.core.rmem_max = 16777216</span><br><span class="line">net.core.wmem_max = 16777216</span><br><span class="line">net.ipv4.tcp_timestamps = 0</span><br><span class="line">net.ipv4.tcp_synack_retries = 2</span><br><span class="line">net.ipv4.tcp_syn_retries = 2</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.tcp_mem = 94500000     915000000       927000000</span><br><span class="line">net.ipv4.tcp_max_orphans = 3276800</span><br><span class="line">net.ipv4.tcp_keepalive_time = 120</span><br><span class="line">net.ipv4.ip_local_port_range = 1024     65535</span><br><span class="line">net.ipv4.tcp_max_tw_buckets = 30000</span><br><span class="line">net.ipv4.tcp_keepalive_probes = 5</span><br><span class="line">net.ipv4.tcp_keepalive_intvl = 15</span><br><span class="line">net.ipv4.tcp_retries2 = 5</span><br><span class="line">net.ipv4.tcp_orphan_retries = 3</span><br><span class="line">net.ipv4.tcp_reordering = 5</span><br><span class="line">net.ipv4.tcp_retrans_collapse = 0</span><br><span class="line">vm.overcommit_memory = 1</span><br><span class="line">vm.dirty_bytes = 33554432</span><br><span class="line">EOF</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<h2 id="NTP设置"><a href="#NTP设置" class="headerlink" title="NTP设置"></a>NTP设置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/sysconfig/ntpd &lt;&lt; EOF</span><br><span class="line">OPTIONS=&quot;-g&quot;</span><br><span class="line">SYNC_HWCLOCK=yes</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/ntp.conf &lt;&lt; EOF</span><br><span class="line">driftfile /var/lib/ntp/drift</span><br><span class="line"></span><br><span class="line">restrict 127.0.0.1 </span><br><span class="line">restrict ::1</span><br><span class="line">restrict default nomodify notrap nopeer noquery</span><br><span class="line"></span><br><span class="line">server cn.ntp.org.cn perfer</span><br><span class="line">server 0.asia.pool.ntp.org iburst</span><br><span class="line">server 1.asia.pool.ntp.org iburst</span><br><span class="line">server 2.asia.pool.ntp.org iburst</span><br><span class="line">server 3.asia.pool.ntp.org iburst</span><br><span class="line">server 0.centos.pool.ntp.org iburst</span><br><span class="line">server 1.centos.pool.ntp.org iburst</span><br><span class="line">server 2.centos.pool.ntp.org iburst</span><br><span class="line">server 3.centos.pool.ntp.org iburst</span><br><span class="line"></span><br><span class="line">includefile /etc/ntp/crypto/pw</span><br><span class="line"></span><br><span class="line">keys /etc/ntp/keys</span><br><span class="line"></span><br><span class="line">disable monitor</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="Dnsmasq配置"><a href="#Dnsmasq配置" class="headerlink" title="Dnsmasq配置"></a>Dnsmasq配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/dnsmasq.conf  &lt;&lt; EOF</span><br><span class="line">conf-dir=/etc/dnsmasq.d/</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/dnsmasq.d/ext.conf  &lt;&lt; EOF</span><br><span class="line">interface=lo</span><br><span class="line">listen-address=127.0.0.1</span><br><span class="line">bind-interfaces</span><br><span class="line">resolv-file=/etc/resolv.dnsmasq.conf</span><br><span class="line">cache-size=4096</span><br><span class="line">no-hosts</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/resolv.dnsmasq.conf  &lt;&lt; EOF</span><br><span class="line">nameserver 114.114.114.114</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">echo &quot;nameserver 127.0.0.1&quot;&gt;/etc/resolv.conf</span><br></pre></td></tr></table></figure>

<h2 id="Zabbix配置"><a href="#Zabbix配置" class="headerlink" title="Zabbix配置"></a>Zabbix配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/zabbix/zabbix_agentd.conf  &lt;&lt; EOF</span><br><span class="line">PidFile=/var/run/zabbix/zabbix_agentd.pid</span><br><span class="line">LogFile=/var/log/zabbix/zabbix_agentd.log</span><br><span class="line">LogFileSize=0</span><br><span class="line">Server=0.0.0.0</span><br><span class="line">ListenPort=10050</span><br><span class="line">StartAgents=3</span><br><span class="line">BufferSize=10240</span><br><span class="line">MaxLinesPerSecond=200</span><br><span class="line">Hostname=xxxxxxxxx</span><br><span class="line"></span><br><span class="line">Include=/etc/zabbix/zabbix_agentd.d/*.conf</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="修改语言"><a href="#修改语言" class="headerlink" title="修改语言"></a>修改语言</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &apos;export LANG=en_US.UTF-8&apos; &gt;&gt; /etc/bashrc</span><br></pre></td></tr></table></figure>

<h2 id="修改时区"><a href="#修改时区" class="headerlink" title="修改时区"></a>修改时区</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure>

<h2 id="优化服务"><a href="#优化服务" class="headerlink" title="优化服务"></a>优化服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl disable wpa_supplicant.service</span><br><span class="line">systemctl stop wpa_supplicant.service</span><br><span class="line">systemctl disable postfix.service</span><br><span class="line">systemctl enable dnsmasq.service</span><br><span class="line">systemctl start dnsmasq.service</span><br><span class="line">systemctl enable ntpd.service</span><br><span class="line">systemctl start ntpd.service</span><br><span class="line">systemctl enable zabbix-agent</span><br></pre></td></tr></table></figure>

<h2 id="系统优化"><a href="#系统优化" class="headerlink" title="系统优化"></a>系统优化</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &apos;/^#@student        -/a *                soft    nofile          1024000\n*                hard    nofile          1024000&apos; /etc/security/limits.conf</span><br></pre></td></tr></table></figure>

<h2 id="SSH设置"><a href="#SSH设置" class="headerlink" title="SSH设置"></a>SSH设置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i &apos;s/^#Port 22/Port 9322/g&apos; /etc/ssh/sshd_config</span><br><span class="line">sed -i &apos;s/^#UseDNS yes/UseDNS no/g&apos; /etc/ssh/sshd_config</span><br><span class="line">sed -i &apos;s/^#PasswordAuthentication yes/PasswordAuthentication no/g&apos; /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>

<h2 id="安全设置"><a href="#安全设置" class="headerlink" title="安全设置"></a>安全设置</h2><ul>
<li>暂时不执行</li>
</ul>
<p>/etc/hosts.allow 允许内网登录ssh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/hosts.allow  &lt;&lt; EOF</span><br><span class="line">sshd:127.0.0.1</span><br><span class="line">sshd:10.0.0.0/8</span><br><span class="line">sshd:192.168.0.0/16</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>/etc/hosts.deny 禁止外网登录ssh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/hosts.deny &lt;&lt; EOF</span><br><span class="line">sshd:all</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="终端及vim-256色"><a href="#终端及vim-256色" class="headerlink" title="终端及vim 256色"></a>终端及vim 256色</h2><p>/etc/bashrc中加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/bashrc &lt;&lt; EOF</span><br><span class="line"></span><br><span class="line">if [ &quot;\$TERM&quot; == &quot;xterm&quot; ]; then</span><br><span class="line">    export TERM=xterm-256color</span><br><span class="line">fi</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>修改/etc/vimrc中的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/vimrc &lt;&lt; EOF</span><br><span class="line"></span><br><span class="line">if &amp;term==&quot;xterm&quot;</span><br><span class="line">     set t_Co=256</span><br><span class="line">     set t_Sb=dm</span><br><span class="line">     set t_Sf=dm</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">set paste</span><br><span class="line"></span><br><span class="line">set shiftwidth=4</span><br><span class="line">set ts=4</span><br><span class="line">set expandtab</span><br><span class="line">%retab!</span><br><span class="line">set nonu</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>


        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2019/08/06/jenkins/">
  Jenkins
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2019/08/06/jenkins/"><span class="article-date">
  2019-08-06
</span>
</a>
        

        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/app-install/">app install</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <h3 id="一、Jenkins概述"><a href="#一、Jenkins概述" class="headerlink" title="一、Jenkins概述"></a>一、Jenkins概述</h3><p><img src="/assets/Jenkins.png" alt="enkin"></p>
<h3 id="二、安装Jenkins"><a href="#二、安装Jenkins" class="headerlink" title="二、安装Jenkins"></a>二、安装Jenkins</h3><h3 id="安装-Java"><a href="#安装-Java" class="headerlink" title="安装 Java"></a>安装 Java</h3><p>下载地址：</p>
<p><a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a></p>
<blockquote>
<p>可能你看到的版本已经更新！</p>
</blockquote>
<p><img src="/assets/image-20180703135948042.png" alt="image-20180703135948042"></p>
<p><strong>wget 方式下载</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget \</span></span><br><span class="line">--no-check-certificate \</span><br><span class="line">--no-cookies --header \</span><br><span class="line"><span class="string">"Cookie: oraclelicense=accept-securebackup-cookie"</span> \</span><br><span class="line">https://download.oracle.com/otn-pub/java/jdk/8u192-b12/750e1c8617c5452694857ad95c3ee230/jdk-8u192-linux-x64.tar.gz</span><br><span class="line"><span class="comment"># 以上命令和参数是在一行</span></span><br></pre></td></tr></table></figure>

<p>下载源码包后，解压</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@blog ~]<span class="comment"># ls</span></span><br><span class="line">anaconda-ks.cfg  jdk-8u171-linux-x64.tar.gz  </span><br><span class="line">[root@blog ~]<span class="comment"># tar -xf jdk-8u192-linux-x64.tar.gz -C /usr/local/jdk1.8.0_192</span></span><br><span class="line">[root@blog ~]<span class="comment"># ls /usr/local/jdk1.8.0_192/</span></span><br><span class="line">bin             LICENSE</span><br><span class="line">COPYRIGHT       man</span><br><span class="line">db              README.html</span><br><span class="line">include         release</span><br><span class="line">javafx-src.zip  src.zip</span><br><span class="line">jdk1.8.0_192    THIRDPARTYLICENSEREADME-JAVAFX.txt</span><br><span class="line">jre             THIRDPARTYLICENSEREADME.txt</span><br><span class="line">lib</span><br></pre></td></tr></table></figure>

<p><strong>设置环境变量</strong></p>
<p><code>/etc/profile</code> 文件最后添加以下内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># set java environment</span></span><br><span class="line">JAVA_HOME=/usr/<span class="built_in">local</span>/jdk1.8.0_192  <span class="comment"># java 安装包的解压目录</span></span><br><span class="line">JRE_HOME=<span class="variable">$JAVA_HOME</span>/jre</span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JRE_HOME</span>/bin</span><br><span class="line">CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar:<span class="variable">$JRE_HOME</span>/lib</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME JRE_HOME PATH CLASSPATH</span><br></pre></td></tr></table></figure>

<p>给环境变量含义</p>
<p><code>JAVA_HOME</code>    指明JDK安装路径，就是刚才安装时解压所指定的路径，此路径下包括lib，bin，jre等文件夹（tomcat 的运行都需要依靠此变量）。</p>
<p><code>CLASSPATH</code>    为java加载类(class or lib)路径，只有类在classpath中，java命令才能识别，CLASSPATH变量值中的<code>.</code>表示当前目录</p>
<p><code>PATH</code>    使得系统可以在任何路径下识别java命令。</p>
<p>特别注意：环境变量值的结尾没有任何符号，不同值之间用:隔开</p>
<p>设置完成后，重启或者执行如下命令是环境变量生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@blog ~]<span class="comment"># source /etc/profile</span></span><br></pre></td></tr></table></figure>

<p>检查版本，以检测安装是否成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@blog ~]<span class="comment"># java -version</span></span><br><span class="line">java version <span class="string">"1.8.0_192"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_192-b11)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.192-b11, mixed mode)</span><br></pre></td></tr></table></figure>

<p>创建软连接</p>
<p>因为 jenkins 启动时需要</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@blog ~]<span class="comment"># ln -s /usr/local/jdk1.8.0_192/bin/java /usr/bin/java</span></span><br></pre></td></tr></table></figure>

<h4 id="下载并安装Jenkins"><a href="#下载并安装Jenkins" class="headerlink" title="下载并安装Jenkins"></a>下载并安装Jenkins</h4><p>官方网址 <a href="https://pkg.jenkins.io/redhat-stable/" target="_blank" rel="noopener">https://pkg.jenkins.io/redhat-stable/</a></p>
<p><img src="/assets/image-20180702195642298.png" alt="image-20180702195642298"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]# wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</span><br><span class="line">[root@jenkins ~]# rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</span><br><span class="line">[root@jenkins ~]# yum install jenkins</span><br></pre></td></tr></table></figure>

<h4 id="相关包介绍"><a href="#相关包介绍" class="headerlink" title="相关包介绍"></a>相关包介绍</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib/jenkins/jenkins.war    WAR包 </span><br><span class="line">/etc/sysconfig/jenkins       	配置文件</span><br><span class="line">/var/lib/jenkins/        		默认的JENKINS_HOME目录</span><br><span class="line">/var/log/jenkins/jenkins.log    Jenkins日志文件</span><br></pre></td></tr></table></figure>

<h4 id="配置与启动"><a href="#配置与启动" class="headerlink" title="配置与启动"></a>配置与启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@jspgou ~]# lsof -i:8080</span><br><span class="line">[root@jspgou ~]# /etc/init.d/jenkins start </span><br><span class="line">或者</span><br><span class="line"><span class="meta">[root@jspgou]#</span><span class="bash"> systemctl start jenkins</span></span><br><span class="line">Starting jenkins (via systemctl):                          [  OK  ]</span><br><span class="line">[root@jspgou ~]# lsof -i:8080</span><br><span class="line">COMMAND   PID    USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">java    26969 jenkins  162u  IPv6  68624      0t0  TCP *:webcache (LISTEN)</span><br><span class="line">[root@jspgou ~]# rpm -qa | grep jenkins</span><br><span class="line">jenkins-2.107.1-1.1.noarch</span><br><span class="line">[root@jspgou ~]# rpm -ql jenkins </span><br><span class="line">/etc/init.d/jenkins</span><br><span class="line">/etc/logrotate.d/jenkins</span><br><span class="line">/etc/sysconfig/jenkins</span><br><span class="line">/usr/lib/jenkins</span><br><span class="line">/usr/lib/jenkins/jenkins.war</span><br><span class="line">/usr/sbin/rcjenkins</span><br><span class="line">/var/cache/jenkins</span><br><span class="line">/var/lib/jenkins</span><br><span class="line">/var/log/jenkins</span><br><span class="line">[root@jspgou ~]#</span><br></pre></td></tr></table></figure>

<h4 id="初始化-jenkins"><a href="#初始化-jenkins" class="headerlink" title="初始化 jenkins"></a>初始化 <code>jenkins</code></h4><p>在浏览器中登录，初始密码在如下文件中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@jspgou ~]# cat /var/lib/jenkins/secrets/initialAdminPassword</span><br><span class="line">389c09a28ecb42fe871a82d4414c5472</span><br><span class="line">[root@jspgou ~]#</span><br></pre></td></tr></table></figure>

<p><img src="/assets/image-20180704141321268.png" alt="image-20180704141321268"></p>
<p><strong>点击 <code>安装推荐的插件</code></strong></p>
<p>后期需要什么插件，再在<code>系统管理</code> 中安装即可</p>
<p><img src="/assets/image-20180705085209072.png" alt="image-20180705085209072"></p>
<p><img src="/assets/image-20180730180807016.png" alt="image-20180730180807016"></p>
<p><strong>创建管理员用户</strong></p>
<p><img src="/assets/image-20180730180931900.png" alt="image-20180730180931900"></p>
<p><img src="/assets/image-20181117101451928-2420892.png" alt="image-20181117101451928"></p>
<h3 id="三、在WEB中配置Jenkins"><a href="#三、在WEB中配置Jenkins" class="headerlink" title="三、在WEB中配置Jenkins"></a>三、在WEB中配置Jenkins</h3><h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4><p>再次登录地址： <a href="http://172.16.153.160:8080" target="_blank" rel="noopener">http://172.16.153.160:8080</a></p>
<blockquote>
<p>假如你刚才没有创建用户，可以继续使用当前已经登录的用户 <code>admin</code> 登按照如下步骤创建用户。</p>
</blockquote>
<h4 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h4><p><strong>系统管理 –&gt; 管理用户</strong></p>
<p><img src="/assets/image-20180710212400761.png" alt="image-20180710212400761"></p>
<p>点击左侧边栏中的 <strong>新建用户</strong></p>
<p><img src="/assets/image-20180710212604362.png" alt="image-20180710212604362"></p>
<p>填入相应的用户信息后点击 <strong>新建用户</strong></p>
<p>其中的电子邮件地址可以是随意的，但是格式必须是正确的邮箱地址的格式。</p>
<p><img src="/assets/image-20180710213038791.png" alt="image-20180710213038791"></p>
<p>创建成功后会自动跳转到<strong><code>用户列表</code></strong>页面</p>
<p><img src="/assets/image-20180710213324271.png" alt="image-20180710213324271"></p>
<h4 id="为用户设置权限"><a href="#为用户设置权限" class="headerlink" title="为用户设置权限"></a>为用户设置权限</h4><p><strong><code>系统管理 --&gt; 全局安全配置</code></strong></p>
<p><img src="/assets/image-20180710213614684.png" alt="image-20180710213614684"></p>
<p>点选 <strong><code>安全矩阵</code></strong>，之后在 <strong><code>添加用户/组</code></strong> 中填写上需要权限管理的用户 ，最后点击 <strong><code>添加</code></strong> 按钮</p>
<p><img src="/assets/image-20181117102544092-2421544.png" alt="image-20181117102544092"></p>
<p><img src="/assets/image-20181117102614091-2421574.png" alt="image-20181117102614091"></p>
<p> 再在最右侧点击全选标识，把所有的权限分配给 <code>admin</code>，</p>
<p><img src="/assets/image-20181117102818640-2421698.png" alt="image-20181117102818640"></p>
<p>最后在屏幕或者浏览器的最下方点击 <strong><code>保存</code></strong> 按钮</p>
<p><img src="/assets/image-20181117102911734-2421751.png" alt="image-20181117102911734"></p>
<p>假如你想为另外一个用户 <code>jenkins</code> 添加除了 管理员权限外的所有权限，按照如下方式添加即可。（需要先去创建这个用户）</p>
<p>再次点击 <strong><code>全局安全配置</code></strong> 用上述的方法为刚才创建的用户 <code>jenkins</code> 添加除了管理员的权限的其他所有权限</p>
<p><img src="/assets/image-20180710215405177.png" alt="image-20180710215405177"></p>
<p><img src="/assets/image-20180710215724298.png" alt="image-20180710215724298"></p>
<p>注销当前管理员用户后，使用新创建的用户登录验证</p>
<p><img src="/assets/image-20180710215856064.png" alt="image-20180710215856064"></p>
<p>会发现新用户 <code>jenkins</code> 没有 <strong><code>系统管理</code></strong>  这个配置项目</p>
<p><img src="/assets/image-20180710220000861.png" alt="image-20180710220000861"></p>
<h4 id="系统管理–添加插件"><a href="#系统管理–添加插件" class="headerlink" title="系统管理–添加插件"></a><strong>系统管理–添加插件</strong></h4><p><img src="/assets/image-20181117104029354-2422429.png" alt="image-20181117104029354"></p>
<p><strong>添加ssh、maven等相关插件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">以下插件需要选择安装</span><br><span class="line">Ansible plugin</span><br><span class="line"></span><br><span class="line">Ant Plugin</span><br><span class="line"></span><br><span class="line">Blue Ocean</span><br><span class="line">Build Timeout</span><br><span class="line"></span><br><span class="line">Email Extension Plugin</span><br><span class="line">	</span><br><span class="line">Git Parameter Plug-In</span><br><span class="line">Gitlab Hook Plugin</span><br><span class="line">GitLab Plugin</span><br><span class="line"></span><br><span class="line">Maven Invoker plugin</span><br><span class="line">Maven Integration plugin</span><br><span class="line"></span><br><span class="line">Publish Over SSH</span><br><span class="line">SSH plugin</span><br><span class="line">SSH Slaves plugin</span><br><span class="line"></span><br><span class="line">Rebuilder</span><br><span class="line">Safe Restart</span><br></pre></td></tr></table></figure>

<p>方法如下图所示：<br><img src="/assets/3.png" alt="3"></p>
<p>点击 <code>直接安装</code></p>
<blockquote>
<p>按照以上方法，把其他插件也安装好</p>
</blockquote>
<h4 id="系统管理–系统设置"><a href="#系统管理–系统设置" class="headerlink" title="系统管理–系统设置"></a><strong>系统管理–系统设置</strong></h4><p><img src="/assets/4.png" alt="4"></p>
<p><strong>系统设置–指定管理员邮箱地址</strong></p>
<p><img src="/assets/image-20180717085425297.png" alt="image-20180717085425297"></p>
<p><strong>系统设置–设置邮件通知的SMTP服务器及其相关配置</strong></p>
<p>邮箱通知配置的前提是把在自己邮箱的提供商地方开通 <code>SMTP</code> 服务，同时需要客户端授权密码</p>
<p><img src="/assets/image-20180627191631085.png" alt="邮箱SMTP"></p>
<p><img src="/assets/image-20180717085726434.png" alt="image-20180717085726434"></p>
<ol>
<li>SMTP 服务器      填写自己邮箱的提供商所提供的信息，主要是指定邮箱发件服务器地址；每个邮箱都不一定相同，这里是 126 邮箱。</li>
<li>邮件后缀   就是你邮件地址后面的部分，如账号： <code>youname@126.com</code> 的后缀就是 <code>@126.com</code></li>
<li>这个邮箱地址需要和前面配置的管理员邮箱地址一致</li>
<li>对 126 的邮箱和腾讯的邮箱，这里的密码并不是你平时登录邮箱的密码，而是通过邮箱的服务提供商那里设置的 <code>客户端授权密码</code></li>
<li>邮件服务器的监听端口， 不使用 <code>SSL 协议</code>  的填写 <code>25</code>；勾选 <code>使用SSL协议</code>的填写<code>465</code> 如下图所示：</li>
</ol>
<p><img src="/assets/image-20180717092523066.png" alt="image-20180717092523066"></p>
<ol start="6">
<li>就是通知邮件的邮箱地址。</li>
<li>可以添加测试按钮，发送测试邮件。</li>
<li>此处看到这个信息，表示配置正确。</li>
</ol>
<p><strong>系统设置–设置SSH 远程服务器地址及其配置</strong></p>
<p>需要安装 <code>Publish over SSH</code> 插件。</p>
<p>如下方式可以检查目前都安装了哪些插件</p>
<p><img src="/assets/image-20180718164835164.png" alt="image-20180718164835164"></p>
<p> 此插件可以实现远程自动部署，就是可以通过 <code>Jenkins</code> 主机，远程连接到 应用服务器，之后把需要部署的应用程序部署到应用服务器上.</p>
<p><code>Jenkins</code> 和 应用服务器的 SSH 连接认证，支持 密码和 密钥两种方式。</p>
<p>这里演示使用密钥的认证方式和远程应用服务器进行认证连接。</p>
<p>首先需要在 <code>jenkins</code> 主机上操作，让应用服务器对 <code>jenkins</code> 主机信任，以便让 jenkins 主机可以免密码登录到 应用服务器上。</p>
<p>第一步，现在 <code>jenkins</code> 主机上建立自己的密钥对儿</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># ssh-keygen</span></span><br><span class="line"><span class="comment"># 执行以上命令后，一路按 回车 键即可把自己的密钥对创建成功</span></span><br></pre></td></tr></table></figure>

<p>第二步，拷贝 <code>jenkins</code> 主机的公钥到应用服务器上</p>
<p>还是在 <code>jenkins</code> 主机上操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># ssh-copy-id yangge@10.18.44.86</span></span><br><span class="line"><span class="comment"># yangge  是远程应用服务器上应用程序的属主用户，就是应用服务器将会使用 yangge 这个用户进行启动相关应用程序，比如 nginx、tomcat 等。</span></span><br><span class="line"><span class="comment"># 10.18.44.86 是远程应用服务器的 ip</span></span><br></pre></td></tr></table></figure>

<p>完成以上两步后就可以配置 <code>Publish over SSH</code>了</p>
<p><code>系统管理</code>–&gt;<code>系统设置</code> –&gt; <code>Publish overSSH</code></p>
<p>首先配置 <code>jenkins</code> 主机的私钥, 此处也有两种方式</p>
<p>a. 配置 <code>jenkins</code> 主机 <code>root</code> 用户的私钥路径，但是需要把私钥复制到 <code>jenkins</code> 程序的家目录下，这里是 <code>/var/lib/jenkins/</code></p>
<p>下面我是把私钥拷贝到 <code>/var/lib/jenkins/.ssh/</code> 下了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># c</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># cp ~/.ssh/id_rsa /var/lib/jenkins/.ssh/</span></span><br><span class="line"></span><br><span class="line">修改文件属主和权限:</span><br><span class="line">[root@jenkins ~]<span class="comment"># cd /var/lib/jenkins/.ssh/</span></span><br><span class="line">[root@jenkins .ssh]<span class="comment"># chown jenkins.jenkins id_rsa</span></span><br><span class="line">[root@jenkins .ssh]<span class="comment"># chmod 600 id_rsa</span></span><br></pre></td></tr></table></figure>

<p>之后把这个路径 配置在 页面中</p>
<p><img src="/assets/image-20180718175547194.png" alt="image-20180718175547194"></p>
<p>b.  另一种方式是把私钥的内容之间粘贴到 <code>key</code> 配置项的密钥框里</p>
<p><img src="/assets/image-20180718180041284.png" alt="image-20180718180041284"></p>
<p>接着就可以配置远程应用服务器的信息了</p>
<p>点击 <code>添加按钮</code>即可，此处可以添加多个，但是需要给这些应用服务器分别建立信任关系。</p>
<p><img src="/assets/image-20180718174111641.png" alt="image-20180718174111641"></p>
<p>部分设置项说明</p>
<ul>
<li><p><code>Passphrase</code>：密码（私钥的保护密码，如果你设置了）</p>
</li>
<li><p><code>SSH Server Name</code>：这个连接项的名字（自定义的）</p>
</li>
<li><p><code>Hostname</code>：需要ssh 连接的远程应用服务器ip地址</p>
</li>
<li><p><code>Username</code>：远程应用服务器的用户名，这个用户名应该已经和 <code>jenkins</code> 主机建立的信任关系</p>
</li>
<li><p><code>Remote Directory</code>：远程应用服务器的应用程序部署的目录</p>
<blockquote>
<p>注意： 这里的目录会作为此服务器代码存放到根目录，之后你</p>
<p>需要把 <code>Maven</code> 打好的包传到此应用服务器中，就是相对于这个目录</p>
<p>来指的具体的位置的。比如目前指定的是 <code>/app/code</code>，在构建任务中，指定构建后的 <code>*.jar</code> 包传到目录 <code>/student</code> 目录，实际在此应用服务器中的完整路径是 <code>/app/code/student/</code> 目录下。</p>
</blockquote>
</li>
<li><p><code>Use password authentication, or use a different key</code>：使用密码验证(使用密码验证时，需要打开处)</p>
</li>
</ul>
<p>配置完成后可点击<code>Test Configuration</code>测试到目标主机的连接，出现<code>success</code>则成功连接</p>
<p><img src="/assets/image-20180718180942337.png" alt="image-20180718180942337"></p>
<p>最后别忘记点击页码下方的 <code>保存</code> 按钮</p>
<p><img src="/assets/image-20180718181237140.png" alt="image-20180718181237140"></p>
<p><strong>系统管理–全局工具配置</strong></p>
<p><img src="/assets/5.png" alt="5"></p>
<p><strong>全局工具配置–配置jdk</strong></p>
<p>先在 <code>jenkins</code> 主机上找到 <code>java</code> 的安装路径</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># echo $JAVA_HOME</span></span><br><span class="line">/usr/<span class="built_in">local</span>/jdk1.8.0_171</span><br></pre></td></tr></table></figure>

<p>之后在页面上配置</p>
<p><img src="/assets/image-20180718181640390.png" alt="image-20180718181640390"></p>
<p>把安装的路径粘贴到页面中的 <code>JAVA_HOME</code>  配置框内，再点击 <code>Save</code> 按钮</p>
<p><img src="/assets/image-20180718181747402.png" alt="image-20180718181747402"></p>
<p><strong>全局工具配置–配置maven</strong></p>
<p>配置方法和思路同上</p>
<p><img src="/assets/7.png" alt="7"></p>
<h4 id="配置Credentials"><a href="#配置Credentials" class="headerlink" title="配置Credentials"></a>配置Credentials</h4><p>在Gitlab上创建一个==Jenkins==用户：</p>
<p><img src="/assets/image-20181117134035204-2433235.png" alt="image-20181117134035204"></p>
<p><img src="/assets/image-20181117134108540-2433268.png" alt="image-20181117134108540"></p>
<p><img src="/assets/image-20181117134140401-2433300.png" alt="image-20181117134140401"></p>
<p><img src="/assets/jenkins_credentials01.png" alt="cred1"></p>
<p>并将Jenkins用户加入到相应的组(Group)<br><img src="/assets/jenkins_credentials02.png" alt="cred2"></p>
<p>在Jenkins中添加相关的Credentials:<br><img src="/assets/jenkins_credentials03.png" alt="cred3"></p>
<p>将Gitlab中Jenkins用户的username 和密码填入Credentials中：<br><img src="/assets/jenkins_credentials04.png" alt="cred4"></p>
<p><img src="/assets/image-20181117141347506-2435227.png" alt="image-20181117141347506"></p>
<h4 id="创建Jenkins项目-例1"><a href="#创建Jenkins项目-例1" class="headerlink" title="创建Jenkins项目(例1)"></a>创建Jenkins项目(例1)</h4><p><img src="/assets/image-20181118121634463-2514594.png" alt="image-20181118121634463"></p>
<p><img src="/assets/image-20181118121817636-2514697.png" alt="image-20181118121817636"></p>
<p>*<em>配置项目中的git server *</em></p>
<p><img src="/assets/image-20181118122611823-2515171.png" alt="image-20181118122611823"></p>
<p><strong>添加访问git server的ssh密钥(私钥)</strong></p>
<p><img src="/assets/image-20181117135934800-2434374.png" alt="image-20181117135934800"></p>
<p><img src="/assets/image-20181117140052596-2434452.png" alt="image-20181117140052596"></p>
<p><img src="/assets/image-20181117140417759-2434657.png" alt="image-20181117140417759"></p>
<p><strong>配置 <code>构建触发器</code></strong></p>
<p><img src="/assets/image-20181118123502873-2515702.png" alt="image-20181118123502873"></p>
<blockquote>
<p>这里是每周六， 每隔 3 分钟检查一次远程代码库，假如有远程代码库有新的更新提交, 就会自动挡触发构建。定义时间的方法和 linux 系统中一致。</p>
</blockquote>
<p><strong>配置项目中的构建(使用maven构建包)</strong></p>
<p><img src="/assets/image-20181118123916397-2515956.png" alt="image-20181118123916397"></p>
<p><strong>配置项目中的构建后动作</strong></p>
<p><img src="/assets/image-20181118124449946-2516290.png" alt="image-20181118124449946"></p>
<p><img src="/assets/image-20181118125403668-2516843.png" alt="image-20181118125403668"></p>
<ul>
<li><ol>
<li><p>这里填写的是打好包的路径，是相对路径，相对于工作空间目录的，工作空间默认是在 <code>$JENKINS_HOEM/workspace</code> 目录下。每次新建一个构建任务时，会在此目录下创建一个和任务名同名的目录（比如：<code>HelloMaven</code>），在此目录下存放从远程代码库拉取的源代码，并且构建完成的文件(比如<code>jar</code> 包)也会在 <code>HelloMaven/target</code> 目录下。</p>
</li>
<li><p>是在把打好包的文件传输到远程应用服务器时，不希望被创建的目录名。 这个目录名必须是在 <code>Source files</code> 选项中填写的路径最前面的部分中。</p>
</li>
<li><p>远程应用服务器的目录，这个目录假如没有会被自动创建，但是此目录是给相对路径，相对于之前在<code>系统设置</code>中的 <code>SSH Servers</code> 中配置的服务器端路径，如下图中的 <code>/opt/studentInfo</code></p>
</li>
<li><p>指构建后在远程应用服务器上执行的命令。</p>
<blockquote>
<p>注意：这里执行命令的用户同样是以下图中的<code>Username</code> 里填写的用户的身份执行的。假如执行命令是执行一个在远程应用服务器上的一个脚本，那么路径和文件都必须存在，并且，脚本中的任何相对路径都会相对于此用户的家目录。</p>
</blockquote>
</li>
</ol>
</li>
</ul>
<p><img src="/assets/image-20181118130754999-2517675.png" alt="image-20181118130754999"></p>
<p><strong>在配置完毕的项目上进行构建</strong><br><img src="/assets/image-20181118125520350-2516920.png" alt="image-20181118125520350"></p>
<p><strong>查看本次构建过程</strong><br><img src="/assets/13.png" alt="13"></p>
<p><strong>构建报告</strong><br><img src="/assets/14.png" alt="14"></p>
<p><strong>检查远程应用服务器</strong></p>
<p>以下就是构建完成后把 <code>target</code> 目录下的任何 <code>jar</code>包传输到远程应用服务器上的 <code>/opt/studentInfo/student</code>目录下的结果展示。</p>
<p><img src="/assets/image-20181118125848694-2517128.png" alt="image-20181118125848694"></p>
<h4 id="创建Jenkins项目-例2"><a href="#创建Jenkins项目-例2" class="headerlink" title="创建Jenkins项目(例2)"></a>创建Jenkins项目(例2)</h4><p>首先在使用git 为 code 添加Tag,如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[eric@meteor maven01]$ vim src/main/java/inspiry/cn/maven/HelloWorld.java </span><br><span class="line">[eric@meteor maven01]$ git add . </span><br><span class="line">[eric@meteor maven01]$ git commit -m 'stable branch'</span><br><span class="line">[stable 4cfc2e3] stable branch</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line">[eric@meteor maven01]$ git tag v1.0.2</span><br><span class="line">[eric@meteor maven01]$ git tag</span><br><span class="line">v1.0.2</span><br><span class="line">[eric@meteor maven01]$ git push -u origin stable</span><br><span class="line">Counting objects: 17, done.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (4/4), done.</span><br><span class="line">Writing objects: 100% (9/9), 583 bytes | 0 bytes/s, done.</span><br><span class="line">Total 9 (delta 2), reused 0 (delta 0)</span><br><span class="line">remote: </span><br><span class="line">remote: To create a merge request for stable, visit:</span><br><span class="line">remote:   http://192.168.60.119/plat-sp/maven01/merge_requests/new?merge_request%5Bsource_branch%5D=stable</span><br><span class="line">remote: </span><br><span class="line">To git@192.168.60.119:plat-sp/maven01.git</span><br><span class="line">* [new branch]      stable -&gt; stable</span><br><span class="line">Branch stable set up to track remote branch stable from origin.</span><br><span class="line">[eric@meteor maven01]$ </span><br><span class="line">[eric@meteor maven01]$ git branch</span><br><span class="line">  master</span><br><span class="line">* stable</span><br><span class="line">[eric@meteor maven01]$ git push origin v1.0.2</span><br><span class="line">Total 0 (delta 0), reused 0 (delta 0)</span><br><span class="line">To git@192.168.60.119:plat-sp/maven01.git</span><br><span class="line"> * [new tag]         v1.0.2 -&gt; v1.0.2</span><br><span class="line">[eric@meteor maven01]$</span><br></pre></td></tr></table></figure>

<p><img src="/assets/git_tag1.png" alt="git_tag1"></p>
<p>然后在gitlab中可以查看相关的Tag:<br><img src="/assets/git_tag2.png" alt="git_tag2"></p>
<p>然后添加Jenkins项目时设置如下：<br><img src="/assets/project01.png" alt="proj1"></p>
<p>选择“参数化构建过程”，如下所示：<br><img src="/assets/project02.png" alt="proj2"></p>
<p>指定gitlab 仓库时使用http方式，并选择相关包含读取权限的credentials，如下所示：<br><img src="/assets/project03.png" alt="proj3"></p>
<p>在构建环境中选择“在构建前删除workspace”<br><img src="/assets/project06.png" alt="proj6"></p>
<p>构建过程选择全局设置的MAVEN名称，并指定参数，如下所示：<br><img src="/assets/project04.png" alt="proj4"></p>
<p>构建后将target/*.jar 包推到SSH server 的指定目录下，并执行相关脚本或shell语句，如下所示：<br><img src="/assets/project05.png" alt="proj5"></p>
<p>选择项目构建时，指定需要构建的Tag，如下所示：<br><img src="/assets/build01.png" alt="build1"></p>
<p>构建后结果如下所示：<br><img src="/assets/build02.png" alt="build2"></p>

        
      </div>
    </div>

  
    </div>
  

  
  
    <div class="post-list">
  

    <div class="post-list-item article">
      <h3 class="article-header">
        <a href="/2019/08/06/newpapername/">
  Newpapername
</a>

      </h3>
      

      <div class="article-info">
        <a href="/2019/08/06/newpapername/"><span class="article-date">
  2019-08-06
</span>
</a>
        

        
	<span class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/app-install/">app install</a></li></ul>
	</span>


      </div>
      <div class="article-entry">
        
          <p>sudo apt-get install git<br>apt-get install nodejs<br>apt-get install npm<br>node -v<br>npm -v<br>npm install -g hexo-cli<br>hexo -v<br>hexo init myblog<br>cd myblog<br>npm install</p>
<p>#node_modules: 依赖包</p>
<p>#public：存放生成的页面</p>
<p>#scaffolds：生成文章的一些模板</p>
<p>#source：用来存放你的文章</p>
<p>#themes：主题</p>
<p>#** _config.yml: 博客的配置文件**<br>hexo g<br>hexo server</p>
<p>#打开hexo的服务，在浏览器输入localhost:4000就可以看到你生成的博客了。</p>
<p>#使用ctrl+c可以把服务关掉。<br>git config –global user.name “yourname”<br>git config –global user.email “youremail”</p>
<p>#这里的yourname输入你的GitHub用户名，youremail输入你GitHub的邮箱。这样GitHub才能知道你是不是对应它的账户。</p>
<p>#可以用以下两条，检查一下你有没有输对<br>git config user.name<br>git config user.email<br>ssh-keygen -t rsa -C “youremail”</p>
<p>#然后创建SSH,一路回车<br>ssh -T <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a></p>
<p>#在gitbash中，查看是否成功</p>
<p>#这一步，我们就可以将hexo和GitHub关联起来，也就是将hexo生成的文章部署到GitHub上，打开站点配置文件 _config.yml，翻到最后，修改为<br>YourgithubName就是你的GitHub账户<br>deploy:<br>  type: git<br>  repo: <a href="https://github.com/YourgithubName/YourgithubName.github.io.git" target="_blank" rel="noopener">https://github.com/YourgithubName/YourgithubName.github.io.git</a><br>  branch: master</p>
<p>这个时候需要先安装deploy-git ，也就是部署的命令,这样你才能用命令部署到GitHub。<br>npm install hexo-deployer-git –save</p>
<p>hexo clean<br>hexo generate<br>hexo deploy</p>
<p>其中 hexo clean清除了你之前生成的东西，也可以不加。<br>hexo generate 顾名思义，生成静态文章，可以用 hexo g缩写<br>hexo deploy 部署文章，可以用hexo d缩写</p>
<p>hexo new newpapername<br>hexo clean<br>hexo g<br>hexo d</p>

        
      </div>
    </div>

  
    </div>
  



  <div class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/">Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </div>




          <div class="main-footer">
  
    © 2020 bibi - Powered by <a href="http://hexo.io" target="_blank">Hexo</a> - Theme <a href="https://github.com/denjones/hexo-theme-chan" target="_blank">Chan</a>
  
</div>

      
        </div>
      
    </div>
  </div>
  <script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

  <link rel="stylesheet" href="/PhotoSwipe/photoswipe.css">
  <link rel="stylesheet" href="/PhotoSwipe/default-skin/default-skin.css">

  <!-- Root element of PhotoSwipe. Must have class pswp. -->
  <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
             It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

      <!-- Container that holds slides.
                PhotoSwipe keeps only 3 of them in the DOM to save memory.
                Don't modify these 3 pswp__item elements, data is added later on. -->
      <div class="pswp__container">
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
        <div class="pswp__item"></div>
      </div>

      <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
      <div class="pswp__ui pswp__ui--hidden">

        <div class="pswp__top-bar">

          <!--  Controls are self-explanatory. Order can be changed. -->

          <div class="pswp__counter"></div>

          <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

          <button class="pswp__button pswp__button--share" title="Share"></button>

          <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

          <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

          <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
          <!-- element will get class pswp__preloader--active when preloader is running -->
          <div class="pswp__preloader">
            <div class="pswp__preloader__icn">
              <div class="pswp__preloader__cut">
                <div class="pswp__preloader__donut"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
          <div class="pswp__share-tooltip"></div>
        </div>

        <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>

        <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

        <div class="pswp__caption">
          <div class="pswp__caption__center"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="/PhotoSwipe/photoswipe.js"></script>
  <script src="/PhotoSwipe/photoswipe-ui-default.js"></script>


<script src="/perfect-scrollbar/js/min/perfect-scrollbar.min.js"></script>
<script src="/scripts/main.js"></script>

</body>
</html>
