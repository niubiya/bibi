
<!DOCTYPE html>
<html lang class="loading">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>jenkins - bibi</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="bibi,"> 
    <meta name="description" content="Testing website,一、Jenkins概述
二、安装Jenkins安装 Java下载地址：
https://www.oracle.com/technetwork/java/javase/downloads/jdk8-d,"> 
    <meta name="author" content="Mode"> 
    <link rel="alternative" href="atom.xml" title="bibi" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.ico"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads" src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
</head>
</html>
<body class="loading">
    <span id="config-title" style="display:none">bibi</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;" data-url="http://yxbibi.com"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle">jenkins</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="获取二维码" class="icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">jenkins</h1>
        <div class="stuff">
            <span>八月 06, 2019</span>
            
  <ul class="post-tags-list"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/app-install/">app install</a></li></ul>


        </div>
        <div class="content markdown">
            <h3 id="一、Jenkins概述"><a href="#一、Jenkins概述" class="headerlink" title="一、Jenkins概述"></a>一、Jenkins概述</h3><p><img src="./assets/Jenkins.png" alt="enkin"></p>
<h3 id="二、安装Jenkins"><a href="#二、安装Jenkins" class="headerlink" title="二、安装Jenkins"></a>二、安装Jenkins</h3><h3 id="安装-Java"><a href="#安装-Java" class="headerlink" title="安装 Java"></a>安装 Java</h3><p>下载地址：</p>
<p><a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a></p>
<blockquote>
<p>可能你看到的版本已经更新！</p>
</blockquote>
<p><img src="assets/image-20180703135948042.png" alt="image-20180703135948042"></p>
<p><strong>wget 方式下载</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget \</span></span><br><span class="line">--no-check-certificate \</span><br><span class="line">--no-cookies --header \</span><br><span class="line"><span class="string">"Cookie: oraclelicense=accept-securebackup-cookie"</span> \</span><br><span class="line">https://download.oracle.com/otn-pub/java/jdk/8u192-b12/750e1c8617c5452694857ad95c3ee230/jdk-8u192-linux-x64.tar.gz</span><br><span class="line"><span class="comment"># 以上命令和参数是在一行</span></span><br></pre></td></tr></table></figure>

<p>下载源码包后，解压</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@blog ~]<span class="comment"># ls</span></span><br><span class="line">anaconda-ks.cfg  jdk-8u171-linux-x64.tar.gz  </span><br><span class="line">[root@blog ~]<span class="comment"># tar -xf jdk-8u192-linux-x64.tar.gz -C /usr/local/jdk1.8.0_192</span></span><br><span class="line">[root@blog ~]<span class="comment"># ls /usr/local/jdk1.8.0_192/</span></span><br><span class="line">bin             LICENSE</span><br><span class="line">COPYRIGHT       man</span><br><span class="line">db              README.html</span><br><span class="line">include         release</span><br><span class="line">javafx-src.zip  src.zip</span><br><span class="line">jdk1.8.0_192    THIRDPARTYLICENSEREADME-JAVAFX.txt</span><br><span class="line">jre             THIRDPARTYLICENSEREADME.txt</span><br><span class="line">lib</span><br></pre></td></tr></table></figure>

<p><strong>设置环境变量</strong></p>
<p><code>/etc/profile</code> 文件最后添加以下内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># set java environment</span></span><br><span class="line">JAVA_HOME=/usr/<span class="built_in">local</span>/jdk1.8.0_192  <span class="comment"># java 安装包的解压目录</span></span><br><span class="line">JRE_HOME=<span class="variable">$JAVA_HOME</span>/jre</span><br><span class="line">PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JRE_HOME</span>/bin</span><br><span class="line">CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar:<span class="variable">$JRE_HOME</span>/lib</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME JRE_HOME PATH CLASSPATH</span><br></pre></td></tr></table></figure>

<p>给环境变量含义</p>
<p><code>JAVA_HOME</code>    指明JDK安装路径，就是刚才安装时解压所指定的路径，此路径下包括lib，bin，jre等文件夹（tomcat 的运行都需要依靠此变量）。</p>
<p><code>CLASSPATH</code>    为java加载类(class or lib)路径，只有类在classpath中，java命令才能识别，CLASSPATH变量值中的<code>.</code>表示当前目录</p>
<p><code>PATH</code>    使得系统可以在任何路径下识别java命令。</p>
<p>特别注意：环境变量值的结尾没有任何符号，不同值之间用:隔开</p>
<p>设置完成后，重启或者执行如下命令是环境变量生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@blog ~]<span class="comment"># source /etc/profile</span></span><br></pre></td></tr></table></figure>

<p>检查版本，以检测安装是否成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@blog ~]<span class="comment"># java -version</span></span><br><span class="line">java version <span class="string">"1.8.0_192"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_192-b11)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.192-b11, mixed mode)</span><br></pre></td></tr></table></figure>

<p>创建软连接</p>
<p>因为 jenkins 启动时需要</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@blog ~]<span class="comment"># ln -s /usr/local/jdk1.8.0_192/bin/java /usr/bin/java</span></span><br></pre></td></tr></table></figure>

<h4 id="下载并安装Jenkins"><a href="#下载并安装Jenkins" class="headerlink" title="下载并安装Jenkins"></a>下载并安装Jenkins</h4><p>官方网址 <a href="https://pkg.jenkins.io/redhat-stable/" target="_blank" rel="noopener">https://pkg.jenkins.io/redhat-stable/</a></p>
<p><img src="assets/image-20180702195642298.png" alt="image-20180702195642298"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]# wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</span><br><span class="line">[root@jenkins ~]# rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</span><br><span class="line">[root@jenkins ~]# yum install jenkins</span><br></pre></td></tr></table></figure>

<h4 id="相关包介绍"><a href="#相关包介绍" class="headerlink" title="相关包介绍"></a>相关包介绍</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib/jenkins/jenkins.war    WAR包 </span><br><span class="line">/etc/sysconfig/jenkins       	配置文件</span><br><span class="line">/var/lib/jenkins/        		默认的JENKINS_HOME目录</span><br><span class="line">/var/log/jenkins/jenkins.log    Jenkins日志文件</span><br></pre></td></tr></table></figure>

<h4 id="配置与启动"><a href="#配置与启动" class="headerlink" title="配置与启动"></a>配置与启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@jspgou ~]# lsof -i:8080</span><br><span class="line">[root@jspgou ~]# /etc/init.d/jenkins start </span><br><span class="line">或者</span><br><span class="line"><span class="meta">[root@jspgou]#</span><span class="bash"> systemctl start jenkins</span></span><br><span class="line">Starting jenkins (via systemctl):                          [  OK  ]</span><br><span class="line">[root@jspgou ~]# lsof -i:8080</span><br><span class="line">COMMAND   PID    USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">java    26969 jenkins  162u  IPv6  68624      0t0  TCP *:webcache (LISTEN)</span><br><span class="line">[root@jspgou ~]# rpm -qa | grep jenkins</span><br><span class="line">jenkins-2.107.1-1.1.noarch</span><br><span class="line">[root@jspgou ~]# rpm -ql jenkins </span><br><span class="line">/etc/init.d/jenkins</span><br><span class="line">/etc/logrotate.d/jenkins</span><br><span class="line">/etc/sysconfig/jenkins</span><br><span class="line">/usr/lib/jenkins</span><br><span class="line">/usr/lib/jenkins/jenkins.war</span><br><span class="line">/usr/sbin/rcjenkins</span><br><span class="line">/var/cache/jenkins</span><br><span class="line">/var/lib/jenkins</span><br><span class="line">/var/log/jenkins</span><br><span class="line">[root@jspgou ~]#</span><br></pre></td></tr></table></figure>

<h4 id="初始化-jenkins"><a href="#初始化-jenkins" class="headerlink" title="初始化 jenkins"></a>初始化 <code>jenkins</code></h4><p>在浏览器中登录，初始密码在如下文件中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@jspgou ~]# cat /var/lib/jenkins/secrets/initialAdminPassword</span><br><span class="line">389c09a28ecb42fe871a82d4414c5472</span><br><span class="line">[root@jspgou ~]#</span><br></pre></td></tr></table></figure>

<p><img src="assets/image-20180704141321268.png" alt="image-20180704141321268"></p>
<p><strong>点击 <code>安装推荐的插件</code></strong></p>
<p>后期需要什么插件，再在<code>系统管理</code> 中安装即可</p>
<p><img src="assets/image-20180705085209072.png" alt="image-20180705085209072"></p>
<p><img src="assets/image-20180730180807016.png" alt="image-20180730180807016"></p>
<p><strong>创建管理员用户</strong></p>
<p><img src="assets/image-20180730180931900.png" alt="image-20180730180931900"></p>
<p><img src="assets/image-20181117101451928-2420892.png" alt="image-20181117101451928"></p>
<h3 id="三、在WEB中配置Jenkins"><a href="#三、在WEB中配置Jenkins" class="headerlink" title="三、在WEB中配置Jenkins"></a>三、在WEB中配置Jenkins</h3><h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4><p>再次登录地址： <a href="http://172.16.153.160:8080" target="_blank" rel="noopener">http://172.16.153.160:8080</a></p>
<blockquote>
<p>假如你刚才没有创建用户，可以继续使用当前已经登录的用户 <code>admin</code> 登按照如下步骤创建用户。</p>
</blockquote>
<h4 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h4><p><strong>系统管理 –&gt; 管理用户</strong></p>
<p><img src="assets/image-20180710212400761.png" alt="image-20180710212400761"></p>
<p>点击左侧边栏中的 <strong>新建用户</strong></p>
<p><img src="assets/image-20180710212604362.png" alt="image-20180710212604362"></p>
<p>填入相应的用户信息后点击 <strong>新建用户</strong></p>
<p>其中的电子邮件地址可以是随意的，但是格式必须是正确的邮箱地址的格式。</p>
<p><img src="assets/image-20180710213038791.png" alt="image-20180710213038791"></p>
<p>创建成功后会自动跳转到<strong><code>用户列表</code></strong>页面</p>
<p><img src="assets/image-20180710213324271.png" alt="image-20180710213324271"></p>
<h4 id="为用户设置权限"><a href="#为用户设置权限" class="headerlink" title="为用户设置权限"></a>为用户设置权限</h4><p><strong><code>系统管理 --&gt; 全局安全配置</code></strong></p>
<p><img src="assets/image-20180710213614684.png" alt="image-20180710213614684"></p>
<p>点选 <strong><code>安全矩阵</code></strong>，之后在 <strong><code>添加用户/组</code></strong> 中填写上需要权限管理的用户 ，最后点击 <strong><code>添加</code></strong> 按钮</p>
<p><img src="assets/image-20181117102544092-2421544.png" alt="image-20181117102544092"></p>
<p><img src="assets/image-20181117102614091-2421574.png" alt="image-20181117102614091"></p>
<p> 再在最右侧点击全选标识，把所有的权限分配给 <code>admin</code>，</p>
<p><img src="assets/image-20181117102818640-2421698.png" alt="image-20181117102818640"></p>
<p>最后在屏幕或者浏览器的最下方点击 <strong><code>保存</code></strong> 按钮</p>
<p><img src="assets/image-20181117102911734-2421751.png" alt="image-20181117102911734"></p>
<p>假如你想为另外一个用户 <code>jenkins</code> 添加除了 管理员权限外的所有权限，按照如下方式添加即可。（需要先去创建这个用户）</p>
<p>再次点击 <strong><code>全局安全配置</code></strong> 用上述的方法为刚才创建的用户 <code>jenkins</code> 添加除了管理员的权限的其他所有权限</p>
<p><img src="assets/image-20180710215405177.png" alt="image-20180710215405177"></p>
<p><img src="assets/image-20180710215724298.png" alt="image-20180710215724298"></p>
<p>注销当前管理员用户后，使用新创建的用户登录验证</p>
<p><img src="assets/image-20180710215856064.png" alt="image-20180710215856064"></p>
<p>会发现新用户 <code>jenkins</code> 没有 <strong><code>系统管理</code></strong>  这个配置项目</p>
<p><img src="assets/image-20180710220000861.png" alt="image-20180710220000861"></p>
<h4 id="系统管理–添加插件"><a href="#系统管理–添加插件" class="headerlink" title="系统管理–添加插件"></a><strong>系统管理–添加插件</strong></h4><p><img src="assets/image-20181117104029354-2422429.png" alt="image-20181117104029354"></p>
<p><strong>添加ssh、maven等相关插件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">以下插件需要选择安装</span><br><span class="line">Ansible plugin</span><br><span class="line"></span><br><span class="line">Ant Plugin</span><br><span class="line"></span><br><span class="line">Blue Ocean</span><br><span class="line">Build Timeout</span><br><span class="line"></span><br><span class="line">Email Extension Plugin</span><br><span class="line">	</span><br><span class="line">Git Parameter Plug-In</span><br><span class="line">Gitlab Hook Plugin</span><br><span class="line">GitLab Plugin</span><br><span class="line"></span><br><span class="line">Maven Invoker plugin</span><br><span class="line">Maven Integration plugin</span><br><span class="line"></span><br><span class="line">Publish Over SSH</span><br><span class="line">SSH plugin</span><br><span class="line">SSH Slaves plugin</span><br><span class="line"></span><br><span class="line">Rebuilder</span><br><span class="line">Safe Restart</span><br></pre></td></tr></table></figure>

<p>方法如下图所示：<br><img src="./assets/3.png" alt="3"></p>
<p>点击 <code>直接安装</code></p>
<blockquote>
<p>按照以上方法，把其他插件也安装好</p>
</blockquote>
<h4 id="系统管理–系统设置"><a href="#系统管理–系统设置" class="headerlink" title="系统管理–系统设置"></a><strong>系统管理–系统设置</strong></h4><p><img src="./assets/4.png" alt="4"></p>
<p><strong>系统设置–指定管理员邮箱地址</strong></p>
<p><img src="assets/image-20180717085425297.png" alt="image-20180717085425297"></p>
<p><strong>系统设置–设置邮件通知的SMTP服务器及其相关配置</strong></p>
<p>邮箱通知配置的前提是把在自己邮箱的提供商地方开通 <code>SMTP</code> 服务，同时需要客户端授权密码</p>
<p><img src="assets/image-20180627191631085.png" alt="邮箱SMTP"></p>
<p><img src="assets/image-20180717085726434.png" alt="image-20180717085726434"></p>
<ol>
<li>SMTP 服务器      填写自己邮箱的提供商所提供的信息，主要是指定邮箱发件服务器地址；每个邮箱都不一定相同，这里是 126 邮箱。</li>
<li>邮件后缀   就是你邮件地址后面的部分，如账号： <code>youname@126.com</code> 的后缀就是 <code>@126.com</code></li>
<li>这个邮箱地址需要和前面配置的管理员邮箱地址一致</li>
<li>对 126 的邮箱和腾讯的邮箱，这里的密码并不是你平时登录邮箱的密码，而是通过邮箱的服务提供商那里设置的 <code>客户端授权密码</code></li>
<li>邮件服务器的监听端口， 不使用 <code>SSL 协议</code>  的填写 <code>25</code>；勾选 <code>使用SSL协议</code>的填写<code>465</code> 如下图所示：</li>
</ol>
<p><img src="assets/image-20180717092523066.png" alt="image-20180717092523066"></p>
<ol start="6">
<li>就是通知邮件的邮箱地址。</li>
<li>可以添加测试按钮，发送测试邮件。</li>
<li>此处看到这个信息，表示配置正确。</li>
</ol>
<p><strong>系统设置–设置SSH 远程服务器地址及其配置</strong></p>
<p>需要安装 <code>Publish over SSH</code> 插件。</p>
<p>如下方式可以检查目前都安装了哪些插件</p>
<p><img src="assets/image-20180718164835164.png" alt="image-20180718164835164"></p>
<p> 此插件可以实现远程自动部署，就是可以通过 <code>Jenkins</code> 主机，远程连接到 应用服务器，之后把需要部署的应用程序部署到应用服务器上.</p>
<p><code>Jenkins</code> 和 应用服务器的 SSH 连接认证，支持 密码和 密钥两种方式。</p>
<p>这里演示使用密钥的认证方式和远程应用服务器进行认证连接。</p>
<p>首先需要在 <code>jenkins</code> 主机上操作，让应用服务器对 <code>jenkins</code> 主机信任，以便让 jenkins 主机可以免密码登录到 应用服务器上。</p>
<p>第一步，现在 <code>jenkins</code> 主机上建立自己的密钥对儿</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># ssh-keygen</span></span><br><span class="line"><span class="comment"># 执行以上命令后，一路按 回车 键即可把自己的密钥对创建成功</span></span><br></pre></td></tr></table></figure>

<p>第二步，拷贝 <code>jenkins</code> 主机的公钥到应用服务器上</p>
<p>还是在 <code>jenkins</code> 主机上操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># ssh-copy-id yangge@10.18.44.86</span></span><br><span class="line"><span class="comment"># yangge  是远程应用服务器上应用程序的属主用户，就是应用服务器将会使用 yangge 这个用户进行启动相关应用程序，比如 nginx、tomcat 等。</span></span><br><span class="line"><span class="comment"># 10.18.44.86 是远程应用服务器的 ip</span></span><br></pre></td></tr></table></figure>

<p>完成以上两步后就可以配置 <code>Publish over SSH</code>了</p>
<p><code>系统管理</code>–&gt;<code>系统设置</code> –&gt; <code>Publish overSSH</code></p>
<p>首先配置 <code>jenkins</code> 主机的私钥, 此处也有两种方式</p>
<p>a. 配置 <code>jenkins</code> 主机 <code>root</code> 用户的私钥路径，但是需要把私钥复制到 <code>jenkins</code> 程序的家目录下，这里是 <code>/var/lib/jenkins/</code></p>
<p>下面我是把私钥拷贝到 <code>/var/lib/jenkins/.ssh/</code> 下了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># c</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># cp ~/.ssh/id_rsa /var/lib/jenkins/.ssh/</span></span><br><span class="line"></span><br><span class="line">修改文件属主和权限:</span><br><span class="line">[root@jenkins ~]<span class="comment"># cd /var/lib/jenkins/.ssh/</span></span><br><span class="line">[root@jenkins .ssh]<span class="comment"># chown jenkins.jenkins id_rsa</span></span><br><span class="line">[root@jenkins .ssh]<span class="comment"># chmod 600 id_rsa</span></span><br></pre></td></tr></table></figure>

<p>之后把这个路径 配置在 页面中</p>
<p><img src="assets/image-20180718175547194.png" alt="image-20180718175547194"></p>
<p>b.  另一种方式是把私钥的内容之间粘贴到 <code>key</code> 配置项的密钥框里</p>
<p><img src="assets/image-20180718180041284.png" alt="image-20180718180041284"></p>
<p>接着就可以配置远程应用服务器的信息了</p>
<p>点击 <code>添加按钮</code>即可，此处可以添加多个，但是需要给这些应用服务器分别建立信任关系。</p>
<p><img src="assets/image-20180718174111641.png" alt="image-20180718174111641"></p>
<p>部分设置项说明</p>
<ul>
<li><p><code>Passphrase</code>：密码（私钥的保护密码，如果你设置了）</p>
</li>
<li><p><code>SSH Server Name</code>：这个连接项的名字（自定义的）</p>
</li>
<li><p><code>Hostname</code>：需要ssh 连接的远程应用服务器ip地址</p>
</li>
<li><p><code>Username</code>：远程应用服务器的用户名，这个用户名应该已经和 <code>jenkins</code> 主机建立的信任关系</p>
</li>
<li><p><code>Remote Directory</code>：远程应用服务器的应用程序部署的目录</p>
<blockquote>
<p>注意： 这里的目录会作为此服务器代码存放到根目录，之后你</p>
<p>需要把 <code>Maven</code> 打好的包传到此应用服务器中，就是相对于这个目录</p>
<p>来指的具体的位置的。比如目前指定的是 <code>/app/code</code>，在构建任务中，指定构建后的 <code>*.jar</code> 包传到目录 <code>/student</code> 目录，实际在此应用服务器中的完整路径是 <code>/app/code/student/</code> 目录下。</p>
</blockquote>
</li>
<li><p><code>Use password authentication, or use a different key</code>：使用密码验证(使用密码验证时，需要打开处)</p>
</li>
</ul>
<p>配置完成后可点击<code>Test Configuration</code>测试到目标主机的连接，出现<code>success</code>则成功连接</p>
<p><img src="assets/image-20180718180942337.png" alt="image-20180718180942337"></p>
<p>最后别忘记点击页码下方的 <code>保存</code> 按钮</p>
<p><img src="assets/image-20180718181237140.png" alt="image-20180718181237140"></p>
<p><strong>系统管理–全局工具配置</strong></p>
<p><img src="./assets/5.png" alt="5"></p>
<p><strong>全局工具配置–配置jdk</strong></p>
<p>先在 <code>jenkins</code> 主机上找到 <code>java</code> 的安装路径</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># echo $JAVA_HOME</span></span><br><span class="line">/usr/<span class="built_in">local</span>/jdk1.8.0_171</span><br></pre></td></tr></table></figure>

<p>之后在页面上配置</p>
<p><img src="assets/image-20180718181640390.png" alt="image-20180718181640390"></p>
<p>把安装的路径粘贴到页面中的 <code>JAVA_HOME</code>  配置框内，再点击 <code>Save</code> 按钮</p>
<p><img src="assets/image-20180718181747402.png" alt="image-20180718181747402"></p>
<p><strong>全局工具配置–配置maven</strong></p>
<p>配置方法和思路同上</p>
<p><img src="./assets/7.png" alt="7"></p>
<h4 id="配置Credentials"><a href="#配置Credentials" class="headerlink" title="配置Credentials"></a>配置Credentials</h4><p>在Gitlab上创建一个==Jenkins==用户：</p>
<p><img src="assets/image-20181117134035204-2433235.png" alt="image-20181117134035204"></p>
<p><img src="assets/image-20181117134108540-2433268.png" alt="image-20181117134108540"></p>
<p><img src="assets/image-20181117134140401-2433300.png" alt="image-20181117134140401"></p>
<p><img src="./assets/jenkins_credentials01.png" alt="cred1"></p>
<p>并将Jenkins用户加入到相应的组(Group)<br><img src="./assets/jenkins_credentials02.png" alt="cred2"></p>
<p>在Jenkins中添加相关的Credentials:<br><img src="./assets/jenkins_credentials03.png" alt="cred3"></p>
<p>将Gitlab中Jenkins用户的username 和密码填入Credentials中：<br><img src="./assets/jenkins_credentials04.png" alt="cred4"></p>
<p><img src="assets/image-20181117141347506-2435227.png" alt="image-20181117141347506"></p>
<h4 id="创建Jenkins项目-例1"><a href="#创建Jenkins项目-例1" class="headerlink" title="创建Jenkins项目(例1)"></a>创建Jenkins项目(例1)</h4><p><img src="assets/image-20181118121634463-2514594.png" alt="image-20181118121634463"></p>
<p><img src="assets/image-20181118121817636-2514697.png" alt="image-20181118121817636"></p>
<p>*<em>配置项目中的git server *</em></p>
<p><img src="assets/image-20181118122611823-2515171.png" alt="image-20181118122611823"></p>
<p><strong>添加访问git server的ssh密钥(私钥)</strong></p>
<p><img src="assets/image-20181117135934800-2434374.png" alt="image-20181117135934800"></p>
<p><img src="assets/image-20181117140052596-2434452.png" alt="image-20181117140052596"></p>
<p><img src="assets/image-20181117140417759-2434657.png" alt="image-20181117140417759"></p>
<p><strong>配置 <code>构建触发器</code></strong></p>
<p><img src="assets/image-20181118123502873-2515702.png" alt="image-20181118123502873"></p>
<blockquote>
<p>这里是每周六， 每隔 3 分钟检查一次远程代码库，假如有远程代码库有新的更新提交, 就会自动挡触发构建。定义时间的方法和 linux 系统中一致。</p>
</blockquote>
<p><strong>配置项目中的构建(使用maven构建包)</strong></p>
<p><img src="assets/image-20181118123916397-2515956.png" alt="image-20181118123916397"></p>
<p><strong>配置项目中的构建后动作</strong></p>
<p><img src="assets/image-20181118124449946-2516290.png" alt="image-20181118124449946"></p>
<p><img src="assets/image-20181118125403668-2516843.png" alt="image-20181118125403668"></p>
<ul>
<li><ol>
<li><p>这里填写的是打好包的路径，是相对路径，相对于工作空间目录的，工作空间默认是在 <code>$JENKINS_HOEM/workspace</code> 目录下。每次新建一个构建任务时，会在此目录下创建一个和任务名同名的目录（比如：<code>HelloMaven</code>），在此目录下存放从远程代码库拉取的源代码，并且构建完成的文件(比如<code>jar</code> 包)也会在 <code>HelloMaven/target</code> 目录下。</p>
</li>
<li><p>是在把打好包的文件传输到远程应用服务器时，不希望被创建的目录名。 这个目录名必须是在 <code>Source files</code> 选项中填写的路径最前面的部分中。</p>
</li>
<li><p>远程应用服务器的目录，这个目录假如没有会被自动创建，但是此目录是给相对路径，相对于之前在<code>系统设置</code>中的 <code>SSH Servers</code> 中配置的服务器端路径，如下图中的 <code>/opt/studentInfo</code></p>
</li>
<li><p>指构建后在远程应用服务器上执行的命令。</p>
<blockquote>
<p>注意：这里执行命令的用户同样是以下图中的<code>Username</code> 里填写的用户的身份执行的。假如执行命令是执行一个在远程应用服务器上的一个脚本，那么路径和文件都必须存在，并且，脚本中的任何相对路径都会相对于此用户的家目录。</p>
</blockquote>
</li>
</ol>
</li>
</ul>
<p><img src="assets/image-20181118130754999-2517675.png" alt="image-20181118130754999"></p>
<p><strong>在配置完毕的项目上进行构建</strong><br><img src="assets/image-20181118125520350-2516920.png" alt="image-20181118125520350"></p>
<p><strong>查看本次构建过程</strong><br><img src="./assets/13.png" alt="13"></p>
<p><strong>构建报告</strong><br><img src="./assets/14.png" alt="14"></p>
<p><strong>检查远程应用服务器</strong></p>
<p>以下就是构建完成后把 <code>target</code> 目录下的任何 <code>jar</code>包传输到远程应用服务器上的 <code>/opt/studentInfo/student</code>目录下的结果展示。</p>
<p><img src="assets/image-20181118125848694-2517128.png" alt="image-20181118125848694"></p>
<h4 id="创建Jenkins项目-例2"><a href="#创建Jenkins项目-例2" class="headerlink" title="创建Jenkins项目(例2)"></a>创建Jenkins项目(例2)</h4><p>首先在使用git 为 code 添加Tag,如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[eric@meteor maven01]$ vim src/main/java/inspiry/cn/maven/HelloWorld.java </span><br><span class="line">[eric@meteor maven01]$ git add . </span><br><span class="line">[eric@meteor maven01]$ git commit -m 'stable branch'</span><br><span class="line">[stable 4cfc2e3] stable branch</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line">[eric@meteor maven01]$ git tag v1.0.2</span><br><span class="line">[eric@meteor maven01]$ git tag</span><br><span class="line">v1.0.2</span><br><span class="line">[eric@meteor maven01]$ git push -u origin stable</span><br><span class="line">Counting objects: 17, done.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (4/4), done.</span><br><span class="line">Writing objects: 100% (9/9), 583 bytes | 0 bytes/s, done.</span><br><span class="line">Total 9 (delta 2), reused 0 (delta 0)</span><br><span class="line">remote: </span><br><span class="line">remote: To create a merge request for stable, visit:</span><br><span class="line">remote:   http://192.168.60.119/plat-sp/maven01/merge_requests/new?merge_request%5Bsource_branch%5D=stable</span><br><span class="line">remote: </span><br><span class="line">To git@192.168.60.119:plat-sp/maven01.git</span><br><span class="line">* [new branch]      stable -&gt; stable</span><br><span class="line">Branch stable set up to track remote branch stable from origin.</span><br><span class="line">[eric@meteor maven01]$ </span><br><span class="line">[eric@meteor maven01]$ git branch</span><br><span class="line">  master</span><br><span class="line">* stable</span><br><span class="line">[eric@meteor maven01]$ git push origin v1.0.2</span><br><span class="line">Total 0 (delta 0), reused 0 (delta 0)</span><br><span class="line">To git@192.168.60.119:plat-sp/maven01.git</span><br><span class="line"> * [new tag]         v1.0.2 -&gt; v1.0.2</span><br><span class="line">[eric@meteor maven01]$</span><br></pre></td></tr></table></figure>

<p><img src="./assets/git_tag1.png" alt="git_tag1"></p>
<p>然后在gitlab中可以查看相关的Tag:<br><img src="./assets/git_tag2.png" alt="git_tag2"></p>
<p>然后添加Jenkins项目时设置如下：<br><img src="./assets/project01.png" alt="proj1"></p>
<p>选择“参数化构建过程”，如下所示：<br><img src="./assets/project02.png" alt="proj2"></p>
<p>指定gitlab 仓库时使用http方式，并选择相关包含读取权限的credentials，如下所示：<br><img src="./assets/project03.png" alt="proj3"></p>
<p>在构建环境中选择“在构建前删除workspace”<br><img src="./assets/project06.png" alt="proj6"></p>
<p>构建过程选择全局设置的MAVEN名称，并指定参数，如下所示：<br><img src="./assets/project04.png" alt="proj4"></p>
<p>构建后将target/*.jar 包推到SSH server 的指定目录下，并执行相关脚本或shell语句，如下所示：<br><img src="./assets/project05.png" alt="proj5"></p>
<p>选择项目构建时，指定需要构建的Tag，如下所示：<br><img src="./assets/build01.png" alt="build1"></p>
<p>构建后结果如下所示：<br><img src="./assets/build02.png" alt="build2"></p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="http://domain.com/awesome.mp3">
            </audio>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
        data-ae='false'
        data-ci=''
        data-cs=''
        data-r=''
        data-o=''
        data-a=''
        data-d='false'
    >查看评论</div>


    </div>
    
</div>


    </div>
</div>

</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>
